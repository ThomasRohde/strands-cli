<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Execute agentic workflows with strong observability and schema validation"><meta name=author content="Thomas Klok Rohde"><link href=https://thomasrohde.github.io/strands-cli/v0.3/reference/api/exec/ rel=canonical><link href=../runtime/ rel=prev><link href=../loader/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.3"><title>Execution - Strands CLI</title><link rel=stylesheet href=../../../assets/stylesheets/main.d7758b05.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/_mkdocstrings.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#execution-module class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Strands CLI" class="md-header__button md-logo" aria-label="Strands CLI" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Strands CLI </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Execution </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ThomasRohde/strands-cli title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> ThomasRohde/strands-cli </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../tutorials/quickstart-ollama/ class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=../../examples/ class=md-tabs__link> Examples </a> </li> <li class=md-tabs__item> <a href=../../../explanation/patterns/ class=md-tabs__link> Patterns </a> </li> <li class=md-tabs__item> <a href=../../../howto/validate-workflows/ class=md-tabs__link> How-To </a> </li> <li class=md-tabs__item> <a href=../../../explanation/architecture/ class=md-tabs__link> Explanation </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../cli/ class=md-tabs__link> Reference </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Strands CLI" class="md-nav__button md-logo" aria-label="Strands CLI" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Strands CLI </label> <div class=md-nav__source> <a href=https://github.com/ThomasRohde/strands-cli title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> ThomasRohde/strands-cli </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tutorials/quickstart-ollama/ class=md-nav__link> <span class=md-ellipsis> Quickstart (Ollama) </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/quickstart-bedrock/ class=md-nav__link> <span class=md-ellipsis> Quickstart (Bedrock) </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/quickstart-openai/ class=md-nav__link> <span class=md-ellipsis> Quickstart (OpenAI) </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/first-multi-step/ class=md-nav__link> <span class=md-ellipsis> First Multi-Step Workflow </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../examples/ class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Patterns </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Patterns </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../explanation/patterns/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../howto/patterns/chain/ class=md-nav__link> <span class=md-ellipsis> Chain </span> </a> </li> <li class=md-nav__item> <a href=../../../howto/patterns/workflow/ class=md-nav__link> <span class=md-ellipsis> Workflow </span> </a> </li> <li class=md-nav__item> <a href=../../../howto/patterns/routing/ class=md-nav__link> <span class=md-ellipsis> Routing </span> </a> </li> <li class=md-nav__item> <a href=../../../howto/patterns/parallel/ class=md-nav__link> <span class=md-ellipsis> Parallel </span> </a> </li> <li class=md-nav__item> <a href=../../../howto/patterns/evaluator-optimizer/ class=md-nav__link> <span class=md-ellipsis> Evaluator-Optimizer </span> </a> </li> <li class=md-nav__item> <a href=../../../howto/patterns/graph/ class=md-nav__link> <span class=md-ellipsis> Graph </span> </a> </li> <li class=md-nav__item> <a href=../../../howto/patterns/orchestrator-workers/ class=md-nav__link> <span class=md-ellipsis> Orchestrator-Workers </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> How-To </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> How-To </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../howto/validate-workflows/ class=md-nav__link> <span class=md-ellipsis> Validate Workflows </span> </a> </li> <li class=md-nav__item> <a href=../../../howto/run-workflows/ class=md-nav__link> <span class=md-ellipsis> Run Workflows </span> </a> </li> <li class=md-nav__item> <a href=../../../howto/session-management/ class=md-nav__link> <span class=md-ellipsis> Session Management </span> </a> </li> <li class=md-nav__item> <a href=../../../howto/hitl/ class=md-nav__link> <span class=md-ellipsis> Human-in-the-Loop (HITL) </span> </a> </li> <li class=md-nav__item> <a href=../../../howto/context-management/ class=md-nav__link> <span class=md-ellipsis> Context Management </span> </a> </li> <li class=md-nav__item> <a href=../../../howto/telemetry/ class=md-nav__link> <span class=md-ellipsis> Telemetry </span> </a> </li> <li class=md-nav__item> <a href=../../../howto/tools/ class=md-nav__link> <span class=md-ellipsis> Tools </span> </a> </li> <li class=md-nav__item> <a href=../../../howto/develop-tools/ class=md-nav__link> <span class=md-ellipsis> Develop Tools </span> </a> </li> <li class=md-nav__item> <a href=../../../howto/secrets/ class=md-nav__link> <span class=md-ellipsis> Secrets </span> </a> </li> <li class=md-nav__item> <a href=../../../howto/budgets/ class=md-nav__link> <span class=md-ellipsis> Budgets </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Explanation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Explanation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../explanation/architecture/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../../explanation/design-decisions/ class=md-nav__link> <span class=md-ellipsis> Design Decisions </span> </a> </li> <li class=md-nav__item> <a href=../../../explanation/performance/ class=md-nav__link> <span class=md-ellipsis> Performance </span> </a> </li> <li class=md-nav__item> <a href=../../../explanation/security-model/ class=md-nav__link> <span class=md-ellipsis> Security Model </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7 checked> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=true> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cli/ class=md-nav__link> <span class=md-ellipsis> CLI </span> </a> </li> <li class=md-nav__item> <a href=../../spec/ class=md-nav__link> <span class=md-ellipsis> Spec Quick Reference </span> </a> </li> <li class=md-nav__item> <a href=../../workflow-manual/ class=md-nav__link> <span class=md-ellipsis> Workflow Manual </span> </a> </li> <li class=md-nav__item> <a href=../../session-api/ class=md-nav__link> <span class=md-ellipsis> Session API </span> </a> </li> <li class=md-nav__item> <a href=../../schema/ class=md-nav__link> <span class=md-ellipsis> Schema </span> </a> </li> <li class=md-nav__item> <a href=../../exit-codes/ class=md-nav__link> <span class=md-ellipsis> Exit Codes </span> </a> </li> <li class=md-nav__item> <a href=../../environment/ class=md-nav__link> <span class=md-ellipsis> Environment </span> </a> </li> <li class=md-nav__item> <a href=../../troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> <li class=md-nav__item> <a href=../../security/ class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_10 checked> <label class=md-nav__link for=__nav_7_10 id=__nav_7_10_label tabindex> <span class=md-ellipsis> API </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_10_label aria-expanded=true> <label class=md-nav__title for=__nav_7_10> <span class="md-nav__icon md-icon"></span> API </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../runtime/ class=md-nav__link> <span class=md-ellipsis> Runtime </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Execution </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Execution </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#single-agent class=md-nav__link> <span class=md-ellipsis> Single Agent </span> </a> <nav class=md-nav aria-label="Single Agent"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.single_agent class=md-nav__link> <span class=md-ellipsis> single_agent </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#chain-pattern class=md-nav__link> <span class=md-ellipsis> Chain Pattern </span> </a> <nav class=md-nav aria-label="Chain Pattern"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.chain class=md-nav__link> <span class=md-ellipsis> chain </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#workflow-pattern class=md-nav__link> <span class=md-ellipsis> Workflow Pattern </span> </a> <nav class=md-nav aria-label="Workflow Pattern"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.workflow class=md-nav__link> <span class=md-ellipsis> workflow </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#routing-pattern class=md-nav__link> <span class=md-ellipsis> Routing Pattern </span> </a> <nav class=md-nav aria-label="Routing Pattern"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.routing class=md-nav__link> <span class=md-ellipsis> routing </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#parallel-pattern class=md-nav__link> <span class=md-ellipsis> Parallel Pattern </span> </a> <nav class=md-nav aria-label="Parallel Pattern"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.parallel class=md-nav__link> <span class=md-ellipsis> parallel </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#evaluator-optimizer-pattern class=md-nav__link> <span class=md-ellipsis> Evaluator-Optimizer Pattern </span> </a> <nav class=md-nav aria-label="Evaluator-Optimizer Pattern"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.evaluator_optimizer class=md-nav__link> <span class=md-ellipsis> evaluator_optimizer </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#orchestrator-workers-pattern class=md-nav__link> <span class=md-ellipsis> Orchestrator-Workers Pattern </span> </a> <nav class=md-nav aria-label="Orchestrator-Workers Pattern"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.orchestrator_workers class=md-nav__link> <span class=md-ellipsis> orchestrator_workers </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#graph-pattern class=md-nav__link> <span class=md-ellipsis> Graph Pattern </span> </a> <nav class=md-nav aria-label="Graph Pattern"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.graph class=md-nav__link> <span class=md-ellipsis> graph </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#conditions class=md-nav__link> <span class=md-ellipsis> Conditions </span> </a> <nav class=md-nav aria-label=Conditions> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.conditions class=md-nav__link> <span class=md-ellipsis> conditions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#hooks class=md-nav__link> <span class=md-ellipsis> Hooks </span> </a> <nav class=md-nav aria-label=Hooks> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.hooks class=md-nav__link> <span class=md-ellipsis> hooks </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#execution-utilities class=md-nav__link> <span class=md-ellipsis> Execution Utilities </span> </a> <nav class=md-nav aria-label="Execution Utilities"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.utils class=md-nav__link> <span class=md-ellipsis> utils </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../loader/ class=md-nav__link> <span class=md-ellipsis> Loader </span> </a> </li> <li class=md-nav__item> <a href=../schema/ class=md-nav__link> <span class=md-ellipsis> Schema </span> </a> </li> <li class=md-nav__item> <a href=../telemetry/ class=md-nav__link> <span class=md-ellipsis> Telemetry </span> </a> </li> <li class=md-nav__item> <a href=../tools/ class=md-nav__link> <span class=md-ellipsis> Tools </span> </a> </li> <li class=md-nav__item> <a href=../artifacts/ class=md-nav__link> <span class=md-ellipsis> Artifacts </span> </a> </li> <li class=md-nav__item> <a href=../visualization/ class=md-nav__link> <span class=md-ellipsis> Visualization </span> </a> </li> <li class=md-nav__item> <a href=../capability/ class=md-nav__link> <span class=md-ellipsis> Capability </span> </a> </li> <li class=md-nav__item> <a href=../types/ class=md-nav__link> <span class=md-ellipsis> Types </span> </a> </li> <li class=md-nav__item> <a href=../config/ class=md-nav__link> <span class=md-ellipsis> Config </span> </a> </li> <li class=md-nav__item> <a href=../exit-codes/ class=md-nav__link> <span class=md-ellipsis> Exit Codes </span> </a> </li> <li class=md-nav__item> <a href=../utils/ class=md-nav__link> <span class=md-ellipsis> Utils </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#single-agent class=md-nav__link> <span class=md-ellipsis> Single Agent </span> </a> <nav class=md-nav aria-label="Single Agent"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.single_agent class=md-nav__link> <span class=md-ellipsis> single_agent </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#chain-pattern class=md-nav__link> <span class=md-ellipsis> Chain Pattern </span> </a> <nav class=md-nav aria-label="Chain Pattern"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.chain class=md-nav__link> <span class=md-ellipsis> chain </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#workflow-pattern class=md-nav__link> <span class=md-ellipsis> Workflow Pattern </span> </a> <nav class=md-nav aria-label="Workflow Pattern"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.workflow class=md-nav__link> <span class=md-ellipsis> workflow </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#routing-pattern class=md-nav__link> <span class=md-ellipsis> Routing Pattern </span> </a> <nav class=md-nav aria-label="Routing Pattern"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.routing class=md-nav__link> <span class=md-ellipsis> routing </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#parallel-pattern class=md-nav__link> <span class=md-ellipsis> Parallel Pattern </span> </a> <nav class=md-nav aria-label="Parallel Pattern"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.parallel class=md-nav__link> <span class=md-ellipsis> parallel </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#evaluator-optimizer-pattern class=md-nav__link> <span class=md-ellipsis> Evaluator-Optimizer Pattern </span> </a> <nav class=md-nav aria-label="Evaluator-Optimizer Pattern"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.evaluator_optimizer class=md-nav__link> <span class=md-ellipsis> evaluator_optimizer </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#orchestrator-workers-pattern class=md-nav__link> <span class=md-ellipsis> Orchestrator-Workers Pattern </span> </a> <nav class=md-nav aria-label="Orchestrator-Workers Pattern"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.orchestrator_workers class=md-nav__link> <span class=md-ellipsis> orchestrator_workers </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#graph-pattern class=md-nav__link> <span class=md-ellipsis> Graph Pattern </span> </a> <nav class=md-nav aria-label="Graph Pattern"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.graph class=md-nav__link> <span class=md-ellipsis> graph </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#conditions class=md-nav__link> <span class=md-ellipsis> Conditions </span> </a> <nav class=md-nav aria-label=Conditions> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.conditions class=md-nav__link> <span class=md-ellipsis> conditions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#hooks class=md-nav__link> <span class=md-ellipsis> Hooks </span> </a> <nav class=md-nav aria-label=Hooks> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.hooks class=md-nav__link> <span class=md-ellipsis> hooks </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#execution-utilities class=md-nav__link> <span class=md-ellipsis> Execution Utilities </span> </a> <nav class=md-nav aria-label="Execution Utilities"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#strands_cli.exec.utils class=md-nav__link> <span class=md-ellipsis> utils </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=execution-module>Execution Module<a class=headerlink href=#execution-module title="Permanent link">&para;</a></h1> <p>The execution module contains all workflow pattern executors and execution utilities.</p> <h2 id=single-agent>Single Agent<a class=headerlink href=#single-agent title="Permanent link">&para;</a></h2> <div class="doc doc-object doc-module"> <h3 id=strands_cli.exec.single_agent class="doc doc-heading"> <code>strands_cli.exec.single_agent</code> <a href=#strands_cli.exec.single_agent class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Single-agent workflow executor.</p> <p>Executes single-agent workflows with retry logic and error handling. Supports both chain and workflow patterns (limited to 1 step/task).</p> <details class=execution-flow open> <summary>Execution Flow</summary> <ol> <li>Extract agent and pattern configuration</li> <li>Render task input with Jinja2 template (inject variables)</li> <li>Get or build Strands Agent with tools and model (via AgentCache)</li> <li>Execute agent asynchronously with retry logic</li> <li>Capture response and timing information</li> <li>Return RunResult with success/error status</li> </ol> </details> <details class=phase-3-optimizations open> <summary>Phase 3 Optimizations</summary> <ul> <li>Converted to async function to eliminate per-call event loop creation</li> <li>Integrated AgentCache to enable agent reuse (preparation for future multi-step)</li> <li>Proper cleanup of HTTP clients via AgentCache.close()</li> </ul> </details> <details class=retry-strategy open> <summary>Retry Strategy</summary> <ul> <li>Exponential backoff for transient errors (timeout, connection)</li> <li>Configurable via spec.runtime.failure_policy</li> <li>Default: 3 attempts, 1s-60s backoff</li> </ul> </details> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=strands_cli.exec.single_agent.ExecutionError class="doc doc-heading"> <code>ExecutionError</code> <a href=#strands_cli.exec.single_agent.ExecutionError class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=Exception>Exception</span></code></p> <p>Raised when workflow execution fails.</p> </div> </div> <div class="doc doc-object doc-function"> <h4 id=strands_cli.exec.single_agent.run_single_agent class="doc doc-heading"> <code class="highlight language-python"><span class=n>run_single_agent</span><span class=p>(</span><span class=n>spec</span><span class=p>,</span> <span class=n>variables</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>session_state</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>session_repo</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> <a href=#strands_cli.exec.single_agent.run_single_agent class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Execute a single-agent workflow asynchronously.</p> <p>Complete execution workflow: 1. Extract agent configuration and pattern details 2. Render task input using Jinja2 with variables from spec.inputs.values 3. Get or build Strands Agent with model, tools, and system prompt (via AgentCache) 4. Configure retry policy from spec.runtime.failure_policy 5. Execute agent asynchronously with exponential backoff retry 6. Capture timing (start, end, duration) and response 7. Clean up HTTP clients and cached resources 8. Return RunResult with success status and artifacts</p> <p>Phase 3 Changes: - Converted to async function (no more asyncio.run() inside executor) - Added AgentCache for agent reuse and proper cleanup - HTTP clients properly closed in finally block</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>spec</code> </td> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.Spec href=../types/#strands_cli.types.Spec>Spec</a></code> </td> <td> <div class=doc-md-description> <p>Validated workflow spec (must pass capability check first)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>variables</code> </td> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=str>str</span>] | None</code> </td> <td> <div class=doc-md-description> <p>Optional variables from CLI (already merged into spec.inputs)</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>session_state</code> </td> <td> <code><span title=strands_cli.session.SessionState>SessionState</span> | None</code> </td> <td> <div class=doc-md-description> <p>Existing session state for resume (None = fresh start)</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>session_repo</code> </td> <td> <code><span title=strands_cli.session.file_repository.FileSessionRepository>FileSessionRepository</span> | None</code> </td> <td> <div class=doc-md-description> <p>Repository for checkpointing (None = no checkpoints)</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.RunResult href=../types/#strands_cli.types.RunResult>RunResult</a></code> </td> <td> <div class=doc-md-description> <p>RunResult with:</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.RunResult href=../types/#strands_cli.types.RunResult>RunResult</a></code> </td> <td> <div class=doc-md-description> <ul> <li>success: True if agent executed without errors</li> </ul> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.RunResult href=../types/#strands_cli.types.RunResult>RunResult</a></code> </td> <td> <div class=doc-md-description> <ul> <li>last_response: Agent's final output (for artifact templating)</li> </ul> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.RunResult href=../types/#strands_cli.types.RunResult>RunResult</a></code> </td> <td> <div class=doc-md-description> <ul> <li>error: Error message if execution failed</li> </ul> </div> </td> </tr> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.RunResult href=../types/#strands_cli.types.RunResult>RunResult</a></code> </td> <td> <div class=doc-md-description> <ul> <li>Timing information (started_at, completed_at, duration_seconds)</li> </ul> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.exec.single_agent.ExecutionError href=#strands_cli.exec.single_agent.ExecutionError>ExecutionError</a></code> </td> <td> <div class=doc-md-description> <p>If pattern is unsupported, template rendering fails, or agent construction fails (not for agent runtime errors)</p> </div> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div><h2 id=chain-pattern>Chain Pattern<a class=headerlink href=#chain-pattern title="Permanent link">&para;</a></h2> <div class="doc doc-object doc-module"> <h3 id=strands_cli.exec.chain class="doc doc-heading"> <code>strands_cli.exec.chain</code> <a href=#strands_cli.exec.chain class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Multi-step chain executor.</p> <p>Executes sequential multi-step chains with context passing between steps. Each step receives the outputs of previous steps via template variables.</p> <details class=execution-flow open> <summary>Execution Flow</summary> <ol> <li>Validate chain configuration (at least 1 step)</li> <li>For each step in sequence: a. Build template context (prior step responses + user variables + step.vars) b. Render step input with Jinja2 c. Build/reuse agent for step (with optional tool_overrides) d. Execute agent asynchronously with retry logic e. Track token budget and warn at 80% threshold f. Capture step response and timing</li> <li>Return RunResult with final step response and all step history</li> </ol> </details> <details class=context-threading open> <summary>Context Threading</summary> <ul> <li>Explicit step references: {{ steps[0].response }}, {{ steps[1].response }}</li> <li>Each step receives all prior step outputs in template context</li> <li>Optional per-step variable overrides via step.vars</li> <li>Fail-fast: Stop on first step failure</li> </ul> </details> <details class=budget-enforcement open> <summary>Budget Enforcement</summary> <ul> <li>Track cumulative tokens across all steps</li> <li>Warn at 80% of budgets.max_tokens</li> <li>Hard stop at 100% (if configured)</li> </ul> </details> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=strands_cli.exec.chain.ChainExecutionError class="doc doc-heading"> <code>ChainExecutionError</code> <a href=#strands_cli.exec.chain.ChainExecutionError class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=Exception>Exception</span></code></p> <p>Raised when chain execution fails.</p> </div> </div> <div class="doc doc-object doc-function"> <h4 id=strands_cli.exec.chain.run_chain class="doc doc-heading"> <code class="highlight language-python"><span class=n>run_chain</span><span class=p>(</span><span class=n>spec</span><span class=p>,</span> <span class=n>variables</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>session_state</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>session_repo</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>hitl_response</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> <a href=#strands_cli.exec.chain.run_chain class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Execute a multi-step chain workflow with optional session persistence and HITL support.</p> <p>Executes steps sequentially with context passing. Each step receives all prior step responses via {{ steps[n].response }} template variables.</p> <details class=phase-1-hitl-support open> <summary>Phase 1 HITL Support</summary> <ul> <li>Detects HITL steps (type: hitl) and pauses execution</li> <li>Saves session state before displaying HITL prompt</li> <li>Exits with EX_HITL_PAUSE for user to provide response</li> <li>Resumes with hitl_response and injects into step_history</li> </ul> </details> <details class=phase-4-performance-optimizations open> <summary>Phase 4 Performance Optimizations</summary> <ul> <li>Agent caching: Reuses agents across steps with same (agent_id, tools)</li> <li>Single event loop: No per-step asyncio.run() overhead</li> <li>HTTP client cleanup: Proper resource management via AgentCache.close()</li> </ul> </details> <details class=phase-2-session-support open> <summary>Phase 2 Session Support</summary> <ul> <li>Resume from checkpoint: Skip completed steps on resume</li> <li>Incremental checkpointing: Save state after each step</li> <li>Agent session restoration: Restore conversation history via Strands SDK</li> </ul> </details> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>spec</code> </td> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.Spec href=../types/#strands_cli.types.Spec>Spec</a></code> </td> <td> <div class=doc-md-description> <p>Workflow spec with chain pattern</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>variables</code> </td> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=str>str</span>] | None</code> </td> <td> <div class=doc-md-description> <p>Optional CLI --var overrides</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>session_state</code> </td> <td> <code><span title=strands_cli.session.SessionState>SessionState</span> | None</code> </td> <td> <div class=doc-md-description> <p>Existing session state for resume (None = fresh start)</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>session_repo</code> </td> <td> <code><span title=strands_cli.session.file_repository.FileSessionRepository>FileSessionRepository</span> | None</code> </td> <td> <div class=doc-md-description> <p>Repository for checkpointing (None = no checkpoints)</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>hitl_response</code> </td> <td> <code><span title=str>str</span> | None</code> </td> <td> <div class=doc-md-description> <p>User response when resuming from HITL pause (None = not HITL resume)</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.RunResult href=../types/#strands_cli.types.RunResult>RunResult</a></code> </td> <td> <div class=doc-md-description> <p>RunResult with final step response and execution metadata</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.exec.chain.ChainExecutionError href=#strands_cli.exec.chain.ChainExecutionError>ChainExecutionError</a></code> </td> <td> <div class=doc-md-description> <p>If chain execution fails at any step</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=ValueError>ValueError</span></code> </td> <td> <div class=doc-md-description> <p>If session_state and session_repo not both provided or both None</p> </div> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div><h2 id=workflow-pattern>Workflow Pattern<a class=headerlink href=#workflow-pattern title="Permanent link">&para;</a></h2> <div class="doc doc-object doc-module"> <h3 id=strands_cli.exec.workflow class="doc doc-heading"> <code>strands_cli.exec.workflow</code> <a href=#strands_cli.exec.workflow class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Multi-task workflow executor with DAG support.</p> <p>Executes workflows with task dependencies using topological sort. Tasks execute in dependency order with parallel execution where possible.</p> <details class=execution-flow open> <summary>Execution Flow</summary> <ol> <li>Validate workflow configuration (at least 1 task, no cycles)</li> <li>Build task dependency graph and topological sort</li> <li>Execute tasks in layers (parallel where deps allow): a. Build template context (completed task responses + user variables) b. Render task input with Jinja2 c. Build agent for task d. Execute agent asynchronously e. Track token budget and warn at 80% threshold f. Capture task response and timing</li> <li>Return RunResult with final task response (or aggregated result)</li> </ol> </details> <details class=dependency-resolution open> <summary>Dependency Resolution</summary> <ul> <li>Topological sort ensures tasks run after all dependencies complete</li> <li>Parallel execution within each dependency layer (respecting max_parallel)</li> <li>Fail-fast: Stop on first task failure</li> </ul> </details> <details class=context-threading open> <summary>Context Threading</summary> <ul> <li>{{ tasks.<id>.response }} - Access completed task outputs</li> <li>{{ tasks.<id>.status }} - Task completion status (success/failed)</li> </ul> </details> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=strands_cli.exec.workflow.WorkflowExecutionError class="doc doc-heading"> <code>WorkflowExecutionError</code> <a href=#strands_cli.exec.workflow.WorkflowExecutionError class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=Exception>Exception</span></code></p> <p>Raised when workflow execution fails.</p> </div> </div> <div class="doc doc-object doc-function"> <h4 id=strands_cli.exec.workflow.run_workflow class="doc doc-heading"> <code class="highlight language-python"><span class=n>run_workflow</span><span class=p>(</span><span class=n>spec</span><span class=p>,</span> <span class=n>variables</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>session_state</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>session_repo</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> <a href=#strands_cli.exec.workflow.run_workflow class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Execute a multi-task workflow with DAG dependencies and optional session persistence.</p> <p>Executes tasks in topological order with parallel execution within each layer. Tasks can reference completed task outputs via {{ tasks.<id>.response }}.</p> <details class=phase-5-performance-optimizations open> <summary>Phase 5 Performance Optimizations</summary> <ul> <li>Agent caching: Reuses agents across tasks with same (agent_id, tools)</li> <li>Single event loop: No per-layer asyncio.run() overhead</li> <li>HTTP client cleanup: Proper resource management via AgentCache.close()</li> </ul> </details> <p>Phase 3.1 Session Support: - Resume from checkpoint: Skip completed tasks on resume - Layer checkpointing: Save state after each layer completes - Partial layer resume: Handle tasks completed mid-layer</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>spec</code> </td> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.Spec href=../types/#strands_cli.types.Spec>Spec</a></code> </td> <td> <div class=doc-md-description> <p>Workflow spec with workflow pattern</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>variables</code> </td> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=str>str</span>] | None</code> </td> <td> <div class=doc-md-description> <p>Optional CLI --var overrides</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>session_state</code> </td> <td> <code><span title=strands_cli.session.SessionState>SessionState</span> | None</code> </td> <td> <div class=doc-md-description> <p>Existing session state for resume (None = fresh start)</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>session_repo</code> </td> <td> <code><span title=strands_cli.session.file_repository.FileSessionRepository>FileSessionRepository</span> | None</code> </td> <td> <div class=doc-md-description> <p>Repository for checkpointing (None = no checkpoints)</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.RunResult href=../types/#strands_cli.types.RunResult>RunResult</a></code> </td> <td> <div class=doc-md-description> <p>RunResult with final task response and execution metadata</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.exec.workflow.WorkflowExecutionError href=#strands_cli.exec.workflow.WorkflowExecutionError>WorkflowExecutionError</a></code> </td> <td> <div class=doc-md-description> <p>If workflow execution fails</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=ValueError>ValueError</span></code> </td> <td> <div class=doc-md-description> <p>If session_state and session_repo not both provided or both None</p> </div> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div><h2 id=routing-pattern>Routing Pattern<a class=headerlink href=#routing-pattern title="Permanent link">&para;</a></h2> <div class="doc doc-object doc-module"> <h3 id=strands_cli.exec.routing class="doc doc-heading"> <code>strands_cli.exec.routing</code> <a href=#strands_cli.exec.routing class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Routing pattern executor.</p> <p>Executes routing pattern with router agent classification and conditional route execution. Router agent analyzes input and returns JSON decision specifying which route to execute.</p> <details class=execution-flow open> <summary>Execution Flow</summary> <ol> <li>Validate routing configuration (router + routes)</li> <li>Execute router agent with classification prompt</li> <li>Parse router response to extract JSON {"route": "<route_name>"}</li> <li>Retry on malformed JSON (up to max_retries, default 2)</li> <li>Validate selected route exists</li> <li>Execute selected route's steps as a chain</li> <li>Return RunResult with route execution outcome</li> </ol> </details> <details class=router-output open> <summary>Router Output</summary> <ul> <li>Expected JSON: {"route": "<route_name>"}</li> <li>Parsing strategies: direct JSON, extract JSON block, regex extraction</li> <li>Retry with clarification prompt on malformed responses</li> </ul> </details> <details class=error-handling open> <summary>Error Handling</summary> <ul> <li>Malformed JSON  retry with clarification (up to max_retries)</li> <li>Invalid route name  fail with ExecutionError listing valid routes</li> <li>No fallback behavior (explicit failures only)</li> </ul> </details> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=strands_cli.exec.routing.RoutingExecutionError class="doc doc-heading"> <code>RoutingExecutionError</code> <a href=#strands_cli.exec.routing.RoutingExecutionError class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=Exception>Exception</span></code></p> <p>Raised when routing execution fails.</p> </div> </div> <div class="doc doc-object doc-function"> <h4 id=strands_cli.exec.routing.run_routing class="doc doc-heading"> <code class="highlight language-python"><span class=n>run_routing</span><span class=p>(</span><span class=n>spec</span><span class=p>,</span> <span class=n>variables</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>session_state</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>session_repo</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> <a href=#strands_cli.exec.routing.run_routing class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Execute a routing pattern workflow with optional session persistence.</p> <p>Phase 6 Performance Optimization: - Async execution with shared AgentCache for router and route execution - Single event loop eliminates per-route loop churn - Agents reused when router and route use same agent configuration</p> <p>Phase 3.1 Session Support: - Resume from checkpoint: Skip router if decision already made - Router decision checkpoint: Save route choice before execution - Route execution with resume: Delegate to chain resume logic</p> <p>Executes router agent to classify input, then runs the selected route's chain. Router decision is injected into route context as {{ router.chosen_route }}.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>spec</code> </td> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.Spec href=../types/#strands_cli.types.Spec>Spec</a></code> </td> <td> <div class=doc-md-description> <p>Workflow spec with routing pattern</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>variables</code> </td> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=str>str</span>] | None</code> </td> <td> <div class=doc-md-description> <p>Optional CLI --var overrides</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>session_state</code> </td> <td> <code><span title=strands_cli.session.SessionState>SessionState</span> | None</code> </td> <td> <div class=doc-md-description> <p>Existing session state for resume (None = fresh start)</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>session_repo</code> </td> <td> <code><span title=strands_cli.session.file_repository.FileSessionRepository>FileSessionRepository</span> | None</code> </td> <td> <div class=doc-md-description> <p>Repository for checkpointing (None = no checkpoints)</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.RunResult href=../types/#strands_cli.types.RunResult>RunResult</a></code> </td> <td> <div class=doc-md-description> <p>RunResult with selected route execution outcome</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.exec.routing.RoutingExecutionError href=#strands_cli.exec.routing.RoutingExecutionError>RoutingExecutionError</a></code> </td> <td> <div class=doc-md-description> <p>If routing execution fails</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=ValueError>ValueError</span></code> </td> <td> <div class=doc-md-description> <p>If session_state and session_repo not both provided or both None</p> </div> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div><h2 id=parallel-pattern>Parallel Pattern<a class=headerlink href=#parallel-pattern title="Permanent link">&para;</a></h2> <div class="doc doc-object doc-module"> <h3 id=strands_cli.exec.parallel class="doc doc-heading"> <code>strands_cli.exec.parallel</code> <a href=#strands_cli.exec.parallel class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Parallel branch executor.</p> <p>Executes parallel branches concurrently with optional reduce step for aggregation. Each branch executes its steps sequentially while branches run in parallel.</p> <details class=execution-flow open> <summary>Execution Flow</summary> <ol> <li>Validate parallel configuration (at least 2 branches)</li> <li>Execute all branches concurrently: a. Build branch context (user variables only - isolated from other branches) b. Execute branch steps sequentially (like chain) c. Track tokens per branch d. Respect max_parallel limit via semaphore</li> <li>Collect all branch results in alphabetical order by branch ID</li> <li>Optionally execute reduce step with {{ branches.<id>.response }} context</li> <li>Return RunResult with final response (reduced or aggregated)</li> </ol> </details> <details class=branch-execution open> <summary>Branch Execution</summary> <ul> <li>Each branch is independent (no cross-branch context during execution)</li> <li>Steps within a branch execute sequentially with {{ steps[n].response }} access</li> <li>Fail-fast: First branch failure stops all branches (asyncio.gather with return_exceptions=False)</li> </ul> </details> <details class=budget-enforcement open> <summary>Budget Enforcement</summary> <ul> <li>Track cumulative tokens across all branches and reduce step</li> <li>Warn at 80% of budgets.max_tokens</li> <li>Hard stop at 100% (if configured)</li> </ul> </details> <details class=reduce-step open> <summary>Reduce Step</summary> <ul> <li>Aggregates all branch outputs via template context</li> <li>Template access: {{ branches.web.response }}, {{ branches['docs'].status }}</li> <li>Branch results ordered alphabetically by branch ID for determinism</li> </ul> </details> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=strands_cli.exec.parallel.ParallelExecutionError class="doc doc-heading"> <code>ParallelExecutionError</code> <a href=#strands_cli.exec.parallel.ParallelExecutionError class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=Exception>Exception</span></code></p> <p>Raised when parallel execution fails.</p> </div> </div> <div class="doc doc-object doc-function"> <h4 id=strands_cli.exec.parallel.run_parallel class="doc doc-heading"> <code class="highlight language-python"><span class=n>run_parallel</span><span class=p>(</span><span class=n>spec</span><span class=p>,</span> <span class=n>variables</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>session_state</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>session_repo</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> <a href=#strands_cli.exec.parallel.run_parallel class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Execute parallel pattern with concurrent branches and optional session persistence.</p> <p>Phase 6 Performance Optimization: - Async execution with shared AgentCache across all branches and reduce step - Single event loop eliminates per-branch loop churn - Agents reused when branches use same agent configuration</p> <p>Phase 3.2 Session Support: - Resume from checkpoint: Skip completed branches on resume - Branch-level checkpointing: Save state after all branches complete - Reduce gate: Execute reduce step once after all branches</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>spec</code> </td> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.Spec href=../types/#strands_cli.types.Spec>Spec</a></code> </td> <td> <div class=doc-md-description> <p>Validated workflow spec with parallel pattern</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>variables</code> </td> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=str>str</span>] | None</code> </td> <td> <div class=doc-md-description> <p>CLI --var overrides</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>session_state</code> </td> <td> <code><span title=strands_cli.session.SessionState>SessionState</span> | None</code> </td> <td> <div class=doc-md-description> <p>Existing session state for resume (None = fresh start)</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>session_repo</code> </td> <td> <code><span title=strands_cli.session.file_repository.FileSessionRepository>FileSessionRepository</span> | None</code> </td> <td> <div class=doc-md-description> <p>Repository for checkpointing (None = no checkpoints)</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.RunResult href=../types/#strands_cli.types.RunResult>RunResult</a></code> </td> <td> <div class=doc-md-description> <p>RunResult with final response (reduced or aggregated)</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.exec.parallel.ParallelExecutionError href=#strands_cli.exec.parallel.ParallelExecutionError>ParallelExecutionError</a></code> </td> <td> <div class=doc-md-description> <p>If validation, execution, or reduce fails</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=ValueError>ValueError</span></code> </td> <td> <div class=doc-md-description> <p>If session_state and session_repo not both provided or both None</p> </div> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div><h2 id=evaluator-optimizer-pattern>Evaluator-Optimizer Pattern<a class=headerlink href=#evaluator-optimizer-pattern title="Permanent link">&para;</a></h2> <div class="doc doc-object doc-module"> <h3 id=strands_cli.exec.evaluator_optimizer class="doc doc-heading"> <code>strands_cli.exec.evaluator_optimizer</code> <a href=#strands_cli.exec.evaluator_optimizer class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Evaluator-optimizer pattern executor.</p> <p>Executes iterative refinement pattern with producer-evaluator feedback loops. Producer generates draft, evaluator scores and critiques, producer revises based on feedback.</p> <details class=execution-flow open> <summary>Execution Flow</summary> <ol> <li>Validate evaluator-optimizer configuration</li> <li>Execute producer agent to generate initial draft</li> <li>Evaluation loop (up to max_iters): a. Execute evaluator agent with current draft b. Parse JSON response: {"score": int, "issues": [...], "fixes": [...]} c. Retry once on malformed JSON with clarification prompt d. If score &gt;= min_score  SUCCESS, return draft e. If score &lt; min_score  prepare revision context f. Execute producer agent with revision prompt + evaluator feedback</li> <li>If max_iters exhausted  FAILURE with detailed iteration history</li> </ol> </details> <details class=evaluator-output open> <summary>Evaluator Output</summary> <ul> <li>Expected JSON: {"score": 0-100, "issues": ["..."], "fixes": ["..."]}</li> <li>Parsing strategies: direct JSON, extract JSON block, regex extraction</li> <li>Retry once with clarification prompt on malformed responses</li> </ul> </details> <p>Template Context (Revision): - {{ draft }}: Current draft text - {{ evaluation.score }}: Current score (0-100) - {{ evaluation.issues }}: List of identified issues - {{ evaluation.fixes }}: List of suggested fixes - {{ iteration }}: Current iteration number (1-based)</p> <details class=error-handling open> <summary>Error Handling</summary> <ul> <li>Malformed evaluator JSON  retry once with clarification</li> <li>Max iterations exhausted  raise EvaluatorOptimizerExecutionError with history</li> <li>No fallback behavior (explicit failures only)</li> </ul> </details> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=strands_cli.exec.evaluator_optimizer.EvaluatorOptimizerExecutionError class="doc doc-heading"> <code>EvaluatorOptimizerExecutionError</code> <a href=#strands_cli.exec.evaluator_optimizer.EvaluatorOptimizerExecutionError class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=Exception>Exception</span></code></p> <p>Raised when evaluator-optimizer execution fails.</p> </div> </div> <div class="doc doc-object doc-function"> <h4 id=strands_cli.exec.evaluator_optimizer.run_evaluator_optimizer class="doc doc-heading"> <code class="highlight language-python"><span class=n>run_evaluator_optimizer</span><span class=p>(</span><span class=n>spec</span><span class=p>,</span> <span class=n>variables</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>session_state</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>session_repo</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> <a href=#strands_cli.exec.evaluator_optimizer.run_evaluator_optimizer class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Execute evaluator-optimizer pattern workflow with optional session persistence.</p> <p>Phase 4 Implementation: - Producer-evaluator feedback loops with iterative refinement - JSON parsing with single retry on malformed evaluator responses - Nested template context: {{ evaluation.score }}, {{ evaluation.issues }}, {{ evaluation.fixes }} - Fail on max_iters exhaustion with detailed iteration history - Agent caching for producer/evaluator reuse - Cumulative token budget tracking across all iterations</p> <p>Phase 3.3 Session Support: - Resume from checkpoint: Skip completed iterations on resume - Incremental checkpointing: Save state after each iteration - Iteration history restoration: Preserve draft and evaluation history - Acceptance check on resume: Exit early if already accepted</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>spec</code> </td> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.Spec href=../types/#strands_cli.types.Spec>Spec</a></code> </td> <td> <div class=doc-md-description> <p>Validated workflow specification</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>variables</code> </td> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=str>str</span>] | None</code> </td> <td> <div class=doc-md-description> <p>User-provided template variables</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>session_state</code> </td> <td> <code><span title=strands_cli.session.SessionState>SessionState</span> | None</code> </td> <td> <div class=doc-md-description> <p>Existing session state for resume (None = fresh start)</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>session_repo</code> </td> <td> <code><span title=strands_cli.session.file_repository.FileSessionRepository>FileSessionRepository</span> | None</code> </td> <td> <div class=doc-md-description> <p>Repository for checkpointing (None = no checkpoints)</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.RunResult href=../types/#strands_cli.types.RunResult>RunResult</a></code> </td> <td> <div class=doc-md-description> <p>RunResult with final draft and execution metadata</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.exec.evaluator_optimizer.EvaluatorOptimizerExecutionError href=#strands_cli.exec.evaluator_optimizer.EvaluatorOptimizerExecutionError>EvaluatorOptimizerExecutionError</a></code> </td> <td> <div class=doc-md-description> <p>On configuration errors, max iterations, or unrecoverable failures</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=ValueError>ValueError</span></code> </td> <td> <div class=doc-md-description> <p>If session_state and session_repo not both provided or both None</p> </div> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div><h2 id=orchestrator-workers-pattern>Orchestrator-Workers Pattern<a class=headerlink href=#orchestrator-workers-pattern title="Permanent link">&para;</a></h2> <div class="doc doc-object doc-module"> <h3 id=strands_cli.exec.orchestrator_workers class="doc doc-heading"> <code>strands_cli.exec.orchestrator_workers</code> <a href=#strands_cli.exec.orchestrator_workers class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Orchestrator-workers executor.</p> <p>Implements dynamic task delegation with worker pools. The orchestrator agent breaks down tasks into subtasks and delegates to workers for parallel execution.</p> <details class=execution-flow open> <summary>Execution Flow</summary> <ol> <li>Orchestrator invocation: Request JSON array of subtasks</li> <li>Worker execution: Execute subtasks in parallel (respecting max_workers)</li> <li>Track rounds: Count orchestrator delegation cycles (not worker count)</li> <li>Optional reduce: Aggregate worker outputs</li> <li>Optional writeup: Final synthesis step</li> </ol> </details> <details class=orchestrator-protocol open> <summary>Orchestrator Protocol</summary> <ul> <li>Expected JSON response: [{"task": "description"}, ...]</li> <li>Retry on malformed JSON (up to 2 retries with clarification)</li> <li>Empty array [] signals "no work needed" (success)</li> </ul> </details> <details class=worker-execution open> <summary>Worker Execution</summary> <ul> <li>Workers execute in parallel batches (semaphore control via max_workers)</li> <li>Indexed template access: {{ workers[0].response }}, {{ workers[1].status }}</li> <li>Fail-fast: First worker failure cancels all remaining workers</li> </ul> </details> <details class=round-semantics open> <summary>Round Semantics</summary> <ul> <li>Round = orchestrator delegation cycle (not individual worker executions)</li> <li>max_rounds limits total orchestrator invocations</li> <li>Single round can spawn multiple workers</li> </ul> </details> <details class=budget-enforcement open> <summary>Budget Enforcement</summary> <ul> <li>Cumulative token tracking across orchestrator + workers + reduce + writeup</li> <li>Warn at 80%, hard stop at 100%</li> </ul> </details> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=strands_cli.exec.orchestrator_workers.OrchestratorExecutionError class="doc doc-heading"> <code>OrchestratorExecutionError</code> <a href=#strands_cli.exec.orchestrator_workers.OrchestratorExecutionError class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=Exception>Exception</span></code></p> <p>Raised when orchestrator execution fails.</p> </div> </div> <div class="doc doc-object doc-function"> <h4 id=strands_cli.exec.orchestrator_workers.run_orchestrator_workers class="doc doc-heading"> <code class="highlight language-python"><span class=n>run_orchestrator_workers</span><span class=p>(</span><span class=n>spec</span><span class=p>,</span> <span class=n>variables</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>session_state</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>session_repo</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> <a href=#strands_cli.exec.orchestrator_workers.run_orchestrator_workers class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Execute orchestrator-workers pattern workflow with optional session persistence.</p> <p>Phase 3.2 Session Support: - Resume from checkpoint: Skip orchestrator if workers already executed - Worker-level checkpointing: Save state after workers complete - Reduce/writeup gates: Execute once after workers</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>spec</code> </td> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.Spec href=../types/#strands_cli.types.Spec>Spec</a></code> </td> <td> <div class=doc-md-description> <p>Validated workflow specification</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>variables</code> </td> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=str>str</span>] | None</code> </td> <td> <div class=doc-md-description> <p>CLI variable overrides (from --var flags)</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>session_state</code> </td> <td> <code><span title=strands_cli.session.SessionState>SessionState</span> | None</code> </td> <td> <div class=doc-md-description> <p>Existing session state for resume (None = fresh start)</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>session_repo</code> </td> <td> <code><span title=strands_cli.session.file_repository.FileSessionRepository>FileSessionRepository</span> | None</code> </td> <td> <div class=doc-md-description> <p>Repository for checkpointing (None = no checkpoints)</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.RunResult href=../types/#strands_cli.types.RunResult>RunResult</a></code> </td> <td> <div class=doc-md-description> <p>RunResult with final response and execution metadata</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.exec.orchestrator_workers.OrchestratorExecutionError href=#strands_cli.exec.orchestrator_workers.OrchestratorExecutionError>OrchestratorExecutionError</a></code> </td> <td> <div class=doc-md-description> <p>If orchestrator or worker execution fails</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=ValueError>ValueError</span></code> </td> <td> <div class=doc-md-description> <p>If session_state and session_repo not both provided or both None</p> </div> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div><h2 id=graph-pattern>Graph Pattern<a class=headerlink href=#graph-pattern title="Permanent link">&para;</a></h2> <div class="doc doc-object doc-module"> <h3 id=strands_cli.exec.graph class="doc doc-heading"> <code>strands_cli.exec.graph</code> <a href=#strands_cli.exec.graph class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Graph pattern executor.</p> <p>Executes graph-based workflows with nodes, edges, and conditional transitions. Supports state machines, decision trees, and iterative refinement with cycle protection.</p> <details class=execution-flow open> <summary>Execution Flow</summary> <ol> <li>Validate graph configuration (nodes, edges)</li> <li>Start at entry node (first in YAML order)</li> <li>For each node execution: a. Check iteration limits (global max_steps + per-node max_iterations) b. Build template context with {{ nodes.<id>.response }} access c. Execute node agent with retry logic d. Find next node via edge traversal: - Evaluate static 'to' edges (sequential execution) - Evaluate conditional 'choose' edges (first match wins) e. Track token budget and warn at 80% threshold</li> <li>Terminate at terminal node (no outgoing edges)</li> <li>Return RunResult with terminal node response</li> </ol> </details> <details class=edge-traversal open> <summary>Edge Traversal</summary> <ul> <li>Static edges: Execute 'to' targets sequentially in array order</li> <li>Conditional edges: Evaluate 'choose' conditions in order, transition to first match</li> <li>Special 'else' keyword: Always matches (default fallback)</li> <li>Terminal nodes: Nodes with no outgoing edges (workflow completion)</li> </ul> </details> <details class=cycle-protection open> <summary>Cycle Protection</summary> <ul> <li>Global limit: runtime.budgets.max_steps (default 100) total node executions</li> <li>Per-node limit: pattern.config.max_iterations (default 10) visits per node</li> <li>Prevents infinite loops with clear error messages</li> </ul> </details> <details class=template-context open> <summary>Template Context</summary> <ul> <li>{{ nodes.<id>.response }}: Access node outputs</li> <li>{{ nodes.<id>.agent }}: Agent used by node</li> <li>{{ nodes.<id>.status }}: Execution status (success/error)</li> <li>{{ nodes.<id>.iteration }}: Number of times node executed (for loops)</li> </ul> </details> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=strands_cli.exec.graph.GraphExecutionError class="doc doc-heading"> <code>GraphExecutionError</code> <a href=#strands_cli.exec.graph.GraphExecutionError class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=Exception>Exception</span></code></p> <p>Raised when graph execution fails.</p> </div> </div> <div class="doc doc-object doc-function"> <h4 id=strands_cli.exec.graph.run_graph class="doc doc-heading"> <code class="highlight language-python"><span class=n>run_graph</span><span class=p>(</span><span class=n>spec</span><span class=p>,</span> <span class=n>variables</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>session_state</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>session_repo</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> <a href=#strands_cli.exec.graph.run_graph class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Execute a graph pattern workflow with optional session persistence.</p> <p>Executes nodes via edge traversal with condition evaluation and cycle protection.</p> <p>Phase 3.3 Session Support: - Resume from checkpoint: Restore node results and execution path - Incremental checkpointing: Save state after each node execution - Iteration count restoration: Preserve per-node visit counts for cycle protection - Deterministic edge evaluation: Resume from current_node with full context</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>spec</code> </td> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.Spec href=../types/#strands_cli.types.Spec>Spec</a></code> </td> <td> <div class=doc-md-description> <p>Workflow spec with graph pattern configuration</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>variables</code> </td> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=str>str</span>] | None</code> </td> <td> <div class=doc-md-description> <p>User-provided variables from --var flags</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>session_state</code> </td> <td> <code><span title=strands_cli.session.SessionState>SessionState</span> | None</code> </td> <td> <div class=doc-md-description> <p>Existing session state for resume (None = fresh start)</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>session_repo</code> </td> <td> <code><span title=strands_cli.session.file_repository.FileSessionRepository>FileSessionRepository</span> | None</code> </td> <td> <div class=doc-md-description> <p>Repository for checkpointing (None = no checkpoints)</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.RunResult href=../types/#strands_cli.types.RunResult>RunResult</a></code> </td> <td> <div class=doc-md-description> <p>RunResult with terminal node response and execution metadata</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.exec.graph.GraphExecutionError href=#strands_cli.exec.graph.GraphExecutionError>GraphExecutionError</a></code> </td> <td> <div class=doc-md-description> <p>If graph configuration invalid or execution fails</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=ValueError>ValueError</span></code> </td> <td> <div class=doc-md-description> <p>If session_state and session_repo not both provided or both None</p> </div> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div><h2 id=conditions>Conditions<a class=headerlink href=#conditions title="Permanent link">&para;</a></h2> <div class="doc doc-object doc-module"> <h3 id=strands_cli.exec.conditions class="doc doc-heading"> <code>strands_cli.exec.conditions</code> <a href=#strands_cli.exec.conditions class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Condition evaluation for graph pattern.</p> <p>Provides safe evaluation of conditional expressions in graph edges. Uses Jinja2 template engine for expression evaluation with restricted environment.</p> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=strands_cli.exec.conditions.ConditionEvaluationError class="doc doc-heading"> <code>ConditionEvaluationError</code> <a href=#strands_cli.exec.conditions.ConditionEvaluationError class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=Exception>Exception</span></code></p> <p>Raised when condition evaluation fails.</p> </div> </div> <div class="doc doc-object doc-function"> <h4 id=strands_cli.exec.conditions.evaluate_condition class="doc doc-heading"> <code class="highlight language-python"><span class=n>evaluate_condition</span><span class=p>(</span><span class=n>when_expr</span><span class=p>,</span> <span class=n>context</span><span class=p>)</span></code> <a href=#strands_cli.exec.conditions.evaluate_condition class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Evaluate a conditional expression using Jinja2.</p> <p>Security: Uses SandboxedEnvironment to prevent code execution. Blocks dangerous patterns like <strong>class</strong>, eval, exec, etc.</p> <p>Supports: - Comparisons: ==, !=, &lt;, &lt;=, &gt;, &gt;= - Boolean operators: and, or, not - Template variables: {{ nodes.analyze.score }} - Special keyword: "else" (always true) - Safe filters: default, length, lower, upper, search</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>when_expr</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Condition expression or "else"</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>context</code> </td> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>Template context with variables (nodes, steps, etc.)</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>True if condition evaluates to true, False otherwise</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.exec.conditions.ConditionEvaluationError href=#strands_cli.exec.conditions.ConditionEvaluationError>ConditionEvaluationError</a></code> </td> <td> <div class=doc-md-description> <p>If expression is malformed, contains dangerous patterns, or evaluation fails</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>evaluate_condition</span><span class=p>(</span><span class=s2>&quot;else&quot;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=go>True</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>evaluate_condition</span><span class=p>(</span><span class=s2>&quot;score &gt;= 85&quot;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&quot;score&quot;</span><span class=p>:</span> <span class=mi>90</span><span class=p>})</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=go>True</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>evaluate_condition</span><span class=p>(</span><span class=s2>&quot;nodes.analyze.score &gt;= 85&quot;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&quot;nodes&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;analyze&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;score&quot;</span><span class=p>:</span> <span class=mi>90</span><span class=p>}}})</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=go>True</span>
</span></code></pre></div> </div> </div> <div class="doc doc-object doc-function"> <h4 id=strands_cli.exec.conditions.validate_condition_syntax class="doc doc-heading"> <code class="highlight language-python"><span class=n>validate_condition_syntax</span><span class=p>(</span><span class=n>when_expr</span><span class=p>)</span></code> <a href=#strands_cli.exec.conditions.validate_condition_syntax class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Validate condition syntax without evaluating.</p> <p>Useful for early validation without requiring full context.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>when_expr</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Condition expression to validate</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Tuple of (is_valid, error_message)</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=str>str</span> | None</code> </td> <td> <div class=doc-md-description> <ul> <li>(True, None) if valid</li> </ul> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=tuple>tuple</span>[<span title=bool>bool</span>, <span title=str>str</span> | None]</code> </td> <td> <div class=doc-md-description> <ul> <li>(False, error_message) if invalid</li> </ul> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>validate_condition_syntax</span><span class=p>(</span><span class=s2>&quot;score &gt;= 85&quot;</span><span class=p>)</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=go>(True, None)</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>validate_condition_syntax</span><span class=p>(</span><span class=s2>&quot;invalid syntax }&quot;</span><span class=p>)</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=go>(False, &quot;...&quot;)</span>
</span></code></pre></div> </div> </div> </div> </div> </div><h2 id=hooks>Hooks<a class=headerlink href=#hooks title="Permanent link">&para;</a></h2> <div class="doc doc-object doc-module"> <h3 id=strands_cli.exec.hooks class="doc doc-heading"> <code>strands_cli.exec.hooks</code> <a href=#strands_cli.exec.hooks class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Context management hooks for intelligent workflow execution.</p> <p>This module provides hooks that integrate with Strands SDK's hook system to enable proactive context management during long-running workflows.</p> <details class=hooks open> <summary>Hooks</summary> <p>ProactiveCompactionHook: Triggers context compaction before token overflow NotesAppenderHook: Appends structured notes after each agent invocation</p> </details> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=strands_cli.exec.hooks.NotesAppenderHook class="doc doc-heading"> <code>NotesAppenderHook</code> <a href=#strands_cli.exec.hooks.NotesAppenderHook class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=strands.hooks.HookProvider>HookProvider</span></code></p> <p>Append structured notes after each agent invocation.</p> <p>Captures execution history (input, tools used, outcome) and persists to a Markdown notes file for cross-step continuity and multi-session workflows.</p> <p><strong>Error Handling Policy</strong>: Note write failures are logged but do not raise exceptions. This ensures workflow execution continues even if notes persistence fails (e.g., due to file permissions). Notes are considered auxiliary/observability features, not critical to workflow success.</p> <p><span class=doc-section-title>Attributes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><span title=strands_cli.exec.hooks.NotesAppenderHook.notes_manager>notes_manager</span></code></td> <td> </td> <td> <div class=doc-md-description> <p>NotesManager instance for file operations</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=strands_cli.exec.hooks.NotesAppenderHook.step_counter_ref>step_counter_ref</span></code></td> <td> </td> <td> <div class=doc-md-description> <p>Mutable list container for tracking step count across invocations</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=strands_cli.exec.hooks.NotesAppenderHook.agent_tools>agent_tools</span></code></td> <td> </td> <td> <div class=doc-md-description> <p>Mapping of agent_id to list of tool names for tool tracking</p> </div> </td> </tr> </tbody> </table> <details class=example open> <summary>Example</summary> <blockquote> <blockquote> <blockquote> <p>step_counter = [0] notes_manager = NotesManager("artifacts/notes.md") agent_tools = {"research-agent": ["http_request"]} hook = NotesAppenderHook(notes_manager, step_counter, agent_tools) agent = Agent(name="research-agent", model=model, hooks=[hook])</p> </blockquote> </blockquote> </blockquote> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=strands_cli.exec.hooks.NotesAppenderHook.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=n>notes_manager</span><span class=p>,</span> <span class=n>step_counter_ref</span><span class=p>,</span> <span class=n>agent_tools</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <a href=#strands_cli.exec.hooks.NotesAppenderHook.__init__ class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p>Initialize the notes appender hook.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>notes_manager</code> </td> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.tools.notes_manager.NotesManager href=../tools/#strands_cli.tools.notes_manager.NotesManager>NotesManager</a></code> </td> <td> <div class=doc-md-description> <p>NotesManager instance for writing notes</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>step_counter_ref</code> </td> <td> <code><span title=list>list</span>[<span title=int>int</span>]</code> </td> <td> <div class=doc-md-description> <p>Mutable list [counter] for tracking step index across invocations</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>agent_tools</code> </td> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=list>list</span>[<span title=str>str</span>]] | None</code> </td> <td> <div class=doc-md-description> <p>Optional mapping of agent_id to list of configured tool names</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h5 id=strands_cli.exec.hooks.NotesAppenderHook.register_hooks class="doc doc-heading"> <code class="highlight language-python"><span class=n>register_hooks</span><span class=p>(</span><span class=n>registry</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span></code> <a href=#strands_cli.exec.hooks.NotesAppenderHook.register_hooks class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p>Register hook callbacks with the agent's hook registry.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>registry</code> </td> <td> <code><span title=strands.hooks.HookRegistry>HookRegistry</span></code> </td> <td> <div class=doc-md-description> <p>Hook registry from the agent</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>**kwargs</code> </td> <td> <code><span title=typing.Any>Any</span></code> </td> <td> <div class=doc-md-description> <p>Additional keyword arguments (not used)</p> </div> </td> <td> <code>{}</code> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=strands_cli.exec.hooks.ProactiveCompactionHook class="doc doc-heading"> <code>ProactiveCompactionHook</code> <a href=#strands_cli.exec.hooks.ProactiveCompactionHook class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=strands.hooks.HookProvider>HookProvider</span></code></p> <p>Proactively trigger context compaction before token overflow.</p> <p>Monitors token usage after each agent invocation via accumulated usage metrics and triggers compaction when approaching the configured threshold. This prevents reactive overflow handling and enables controlled context reduction.</p> <p><strong>Token Counting Strategy</strong>: Uses provider-reported metrics when available, falls back to TokenCounter estimation when metrics are missing or stale. This ensures reliable compaction triggering across all providers (Bedrock, Ollama, OpenAI).</p> <p><strong>Single-Fire Behavior</strong>: Compaction triggers only once per hook instance to avoid repeated compaction cycles within the same workflow. For multi-session workflows or workflows requiring multiple compactions, create a new hook instance.</p> <p><span class=doc-section-title>Attributes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><span title=strands_cli.exec.hooks.ProactiveCompactionHook.threshold_tokens>threshold_tokens</span></code></td> <td> </td> <td> <div class=doc-md-description> <p>Token count at which to trigger compaction</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=strands_cli.exec.hooks.ProactiveCompactionHook.model_id>model_id</span></code></td> <td> </td> <td> <div class=doc-md-description> <p>Model identifier for TokenCounter fallback</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=strands_cli.exec.hooks.ProactiveCompactionHook.compacted>compacted</span></code></td> <td> </td> <td> <div class=doc-md-description> <p>Flag tracking whether compaction has been triggered (single-fire)</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=strands_cli.exec.hooks.ProactiveCompactionHook.token_counter>token_counter</span></code></td> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.runtime.token_counter.TokenCounter href=../runtime/#strands_cli.runtime.token_counter.TokenCounter>TokenCounter</a> | None</code> </td> <td> <div class=doc-md-description> <p>TokenCounter instance for fallback estimation</p> </div> </td> </tr> </tbody> </table> <details class=example open> <summary>Example</summary> <blockquote> <blockquote> <blockquote> <p>hook = ProactiveCompactionHook( ... threshold_tokens=60000, model_id="anthropic.claude-3-sonnet-20240229-v1:0" ... ) agent = Agent( ... name="research-agent", model=model, conversation_manager=manager, hooks=[hook] ... )</p> </blockquote> </blockquote> </blockquote> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=strands_cli.exec.hooks.ProactiveCompactionHook.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=n>threshold_tokens</span><span class=p>,</span> <span class=n>model_id</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <a href=#strands_cli.exec.hooks.ProactiveCompactionHook.__init__ class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p>Initialize the proactive compaction hook.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>threshold_tokens</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Trigger compaction when total tokens exceed this value</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>model_id</code> </td> <td> <code><span title=str>str</span> | None</code> </td> <td> <div class=doc-md-description> <p>Optional model identifier for TokenCounter fallback</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h5 id=strands_cli.exec.hooks.ProactiveCompactionHook.register_hooks class="doc doc-heading"> <code class="highlight language-python"><span class=n>register_hooks</span><span class=p>(</span><span class=n>registry</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span></code> <a href=#strands_cli.exec.hooks.ProactiveCompactionHook.register_hooks class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p>Register hook callbacks with the agent's hook registry.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>registry</code> </td> <td> <code><span title=strands.hooks.HookRegistry>HookRegistry</span></code> </td> <td> <div class=doc-md-description> <p>Hook registry from the agent</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>**kwargs</code> </td> <td> <code><span title=typing.Any>Any</span></code> </td> <td> <div class=doc-md-description> <p>Additional keyword arguments (not used)</p> </div> </td> <td> <code>{}</code> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div> </div> </div> </div><h2 id=execution-utilities>Execution Utilities<a class=headerlink href=#execution-utilities title="Permanent link">&para;</a></h2> <div class="doc doc-object doc-module"> <h3 id=strands_cli.exec.utils class="doc doc-heading"> <code>strands_cli.exec.utils</code> <a href=#strands_cli.exec.utils class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Shared execution utilities for all pattern executors.</p> <p>Provides common helpers for retry configuration, budget tracking, and agent execution patterns used across chain, workflow, routing, parallel, and single-agent executors.</p> <p>This module eliminates code duplication across executors and ensures consistent behavior for retry logic, budget enforcement, and error handling.</p> <details class=phase-2-additions open> <summary>Phase 2 Additions</summary> <ul> <li>AgentCache: Executor-scoped agent caching to eliminate redundant builds</li> </ul> </details> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=strands_cli.exec.utils.AgentCache class="doc doc-heading"> <code>AgentCache</code> <a href=#strands_cli.exec.utils.AgentCache class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Executor-scoped agent cache to eliminate redundant builds.</p> <p>Phase 2 Performance Optimization: Caches agents by (agent_id, frozenset(tool_ids)) to reuse agent instances across multiple steps/tasks in the same workflow execution. This eliminates redundant model client creation and agent initialization overhead.</p> <p>Key Features: - Cache keying: (agent_id, frozenset(tool_ids)) ensures correct reuse - Tool tracking: Maintains separate tool instances for cleanup - Async cleanup: Properly closes HTTP executor clients on workflow completion - Observability: Logs cache hits/misses for debugging</p> <p>Lifecycle: 1. Created at start of executor (run_chain, run_workflow, etc.) 2. Used via get_or_build_agent() for each step/task 3. Cleaned up via close() in finally block</p> <details class=example open> <summary>Example</summary> <p>cache = AgentCache() try: agent = await cache.get_or_build_agent(spec, "agent-1", agent_config) result = await agent.invoke_async(prompt) finally: await cache.close()</p> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=strands_cli.exec.utils.AgentCache.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>()</span></code> <a href=#strands_cli.exec.utils.AgentCache.__init__ class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p>Initialize empty agent cache.</p> </div> </div> <div class="doc doc-object doc-function"> <h5 id=strands_cli.exec.utils.AgentCache.close class="doc doc-heading"> <code class="highlight language-python"><span class=n>close</span><span class=p>()</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> <a href=#strands_cli.exec.utils.AgentCache.close class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p>Clean up cached resources.</p> <p>Closes all HTTP executor clients and MCP server connections to release sockets and prevent resource leaks. Should be called in finally block of executor.</p> <p>Phase 9: MCP clients need explicit cleanup despite ToolProvider interface. Without this, MCP server processes remain running and the program hangs.</p> <p>This is critical for long-running workflows with many agents/tools to avoid socket exhaustion and hanging processes.</p> </div> </div> <div class="doc doc-object doc-function"> <h5 id=strands_cli.exec.utils.AgentCache.get_or_build_agent class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_or_build_agent</span><span class=p>(</span><span class=n>spec</span><span class=p>,</span> <span class=n>agent_id</span><span class=p>,</span> <span class=n>agent_config</span><span class=p>,</span> <span class=n>tool_overrides</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>conversation_manager</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>hooks</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>injected_notes</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>worker_index</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>session_manager</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> <a href=#strands_cli.exec.utils.AgentCache.get_or_build_agent class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p>Get cached agent or build new one.</p> <p>Checks cache for existing agent with matching (agent_id, tools, conversation_manager_type, worker_index, session_id). If found, returns cached instance (cache hit). Otherwise, builds new agent and caches it (cache miss).</p> <p>Note: injected_notes is passed through to build_agent but NOT included in cache key, as notes change per step. Agents are cached by identity, tools, and session.</p> <p>Phase 2 Addition: session_manager parameter enables agent conversation restoration from saved sessions. When provided, Strands SDK FileSessionManager restores message history for resume. Session ID from session_manager is included in cache key to ensure proper isolation.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>spec</code> </td> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.Spec href=../types/#strands_cli.types.Spec>Spec</a></code> </td> <td> <div class=doc-md-description> <p>Full workflow spec for agent construction</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>agent_id</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Agent identifier from spec.agents</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>agent_config</code> </td> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.Agent href=../types/#strands_cli.types.Agent>Agent</a></code> </td> <td> <div class=doc-md-description> <p>Agent configuration</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>tool_overrides</code> </td> <td> <code><span title=list>list</span>[<span title=str>str</span>] | None</code> </td> <td> <div class=doc-md-description> <p>Optional tool ID list (overrides agent_config.tools)</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>conversation_manager</code> </td> <td> <code><span title=typing.Any>Any</span> | None</code> </td> <td> <div class=doc-md-description> <p>Optional conversation manager for context compaction</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>hooks</code> </td> <td> <code><span title=list>list</span>[<span title=typing.Any>Any</span>] | None</code> </td> <td> <div class=doc-md-description> <p>Optional list of hooks (e.g., ProactiveCompactionHook, NotesAppenderHook)</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>injected_notes</code> </td> <td> <code><span title=str>str</span> | None</code> </td> <td> <div class=doc-md-description> <p>Optional Markdown notes from previous steps (Phase 6.2)</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>worker_index</code> </td> <td> <code><span title=int>int</span> | None</code> </td> <td> <div class=doc-md-description> <p>Optional worker index for orchestrator-workers pattern isolation</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>session_manager</code> </td> <td> <code><span title=typing.Any>Any</span> | None</code> </td> <td> <div class=doc-md-description> <p>Optional Strands SDK session manager for resume (Phase 2)</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=strands.agent.Agent>Agent</span></code> </td> <td> <div class=doc-md-description> <p>Cached or newly-built Agent instance</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=AdapterError>AdapterError</span></code> </td> <td> <div class=doc-md-description> <p>If agent build fails (from build_agent)</p> </div> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=strands_cli.exec.utils.ExecutionUtilsError class="doc doc-heading"> <code>ExecutionUtilsError</code> <a href=#strands_cli.exec.utils.ExecutionUtilsError class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=Exception>Exception</span></code></p> <p>Raised when execution utility operations fail.</p> </div> </div> <div class="doc doc-object doc-function"> <h4 id=strands_cli.exec.utils.create_retry_decorator class="doc doc-heading"> <code class="highlight language-python"><span class=n>create_retry_decorator</span><span class=p>(</span><span class=n>max_attempts</span><span class=p>,</span> <span class=n>wait_min</span><span class=p>,</span> <span class=n>wait_max</span><span class=p>)</span></code> <a href=#strands_cli.exec.utils.create_retry_decorator class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Create a retry decorator with exponential backoff.</p> <p>Centralizes retry decorator creation for consistent behavior across all executors.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>max_attempts</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Maximum number of attempts</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>wait_min</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Minimum wait time in seconds</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>wait_max</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Maximum wait time in seconds</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Any>Any</span></code> </td> <td> <div class=doc-md-description> <p>Configured retry decorator from tenacity</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h4 id=strands_cli.exec.utils.estimate_tokens class="doc doc-heading"> <code class="highlight language-python"><span class=n>estimate_tokens</span><span class=p>(</span><span class=n>input_text</span><span class=p>,</span> <span class=n>output_text</span><span class=p>)</span></code> <a href=#strands_cli.exec.utils.estimate_tokens class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Estimate token count from text (simple word-based heuristic).</p> <p>This is a simple estimation based on word count. In production, this should be replaced with actual token counting from the provider.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>input_text</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Input prompt</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>output_text</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Agent response</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Estimated token count</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h4 id=strands_cli.exec.utils.get_retry_config class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_retry_config</span><span class=p>(</span><span class=n>spec</span><span class=p>)</span></code> <a href=#strands_cli.exec.utils.get_retry_config class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Get retry configuration from spec.</p> <p>Extracts retry policy from spec.runtime.failure_policy or uses defaults. Used by all executors for consistent retry behavior.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>spec</code> </td> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.types.Spec href=../types/#strands_cli.types.Spec>Spec</a></code> </td> <td> <div class=doc-md-description> <p>Workflow spec with optional failure_policy</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=tuple>tuple</span>[<span title=int>int</span>, <span title=int>int</span>, <span title=int>int</span>]</code> </td> <td> <div class=doc-md-description> <p>Tuple of (max_attempts, wait_min, wait_max) in seconds</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title=strands_cli.exec.utils.ExecutionUtilsError href=#strands_cli.exec.utils.ExecutionUtilsError>ExecutionUtilsError</a></code> </td> <td> <div class=doc-md-description> <p>If retry configuration is invalid</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h4 id=strands_cli.exec.utils.invoke_agent_with_retry class="doc doc-heading"> <code class="highlight language-python"><span class=n>invoke_agent_with_retry</span><span class=p>(</span><span class=n>agent</span><span class=p>,</span> <span class=n>input_text</span><span class=p>,</span> <span class=n>max_attempts</span><span class=p>,</span> <span class=n>wait_min</span><span class=p>,</span> <span class=n>wait_max</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-async"><code>async</code></small> </span> <a href=#strands_cli.exec.utils.invoke_agent_with_retry class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Invoke an agent asynchronously with retry logic.</p> <p>Wraps agent invocation with stdout capture and retry handling. Used across all executors for consistent agent execution.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>agent</code> </td> <td> <code><span title=typing.Any>Any</span></code> </td> <td> <div class=doc-md-description> <p>Strands Agent instance</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>input_text</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Input prompt for the agent</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>max_attempts</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Maximum retry attempts</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>wait_min</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Minimum backoff wait (seconds)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>wait_max</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Maximum backoff wait (seconds)</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Any>Any</span></code> </td> <td> <div class=doc-md-description> <p>Agent response (string or AgentResult)</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=strands_cli.exec.utils.TRANSIENT_ERRORS>TRANSIENT_ERRORS</span></code> </td> <td> <div class=doc-md-description> <p>After all retry attempts exhausted</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=Exception>Exception</span></code> </td> <td> <div class=doc-md-description> <p>For non-transient errors (fail immediately)</p> </div> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/ThomasRohde/strands-cli target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["content.code.copy", "content.code.annotate", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "navigation.tracking", "toc.follow", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.f1b6f286.min.js></script> </body> </html>