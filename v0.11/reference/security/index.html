<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Execute agentic workflows with strong observability and schema validation"><meta name=author content="Thomas Klok Rohde"><link href=https://thomasrohde.github.io/strands-cli/v0.11/reference/security/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.3"><title>Security Considerations - Strands CLI</title><link rel=stylesheet href=../../assets/stylesheets/main.d7758b05.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#security-considerations class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Strands CLI" class="md-header__button md-logo" aria-label="Strands CLI" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Strands CLI </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Security Considerations </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ThomasRohde/strands-cli title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> ThomasRohde/strands-cli </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../tutorials/quickstart-ollama/ class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=../../howto/validate-workflows/ class=md-tabs__link> How-To </a> </li> <li class=md-tabs__item> <a href=../../explanation/ class=md-tabs__link> Explanation </a> </li> <li class=md-tabs__item> <a href=../cli/ class=md-tabs__link> Reference </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Strands CLI" class="md-nav__button md-logo" aria-label="Strands CLI" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Strands CLI </label> <div class=md-nav__source> <a href=https://github.com/ThomasRohde/strands-cli title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> ThomasRohde/strands-cli </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../tutorials/quickstart-ollama/ class=md-nav__link> <span class=md-ellipsis> Tutorials </span> </a> </li> <li class=md-nav__item> <a href=../../howto/validate-workflows/ class=md-nav__link> <span class=md-ellipsis> How-To </span> </a> </li> <li class=md-nav__item> <a href=../../explanation/ class=md-nav__link> <span class=md-ellipsis> Explanation </span> </a> </li> <li class=md-nav__item> <a href=../cli/ class=md-nav__link> <span class=md-ellipsis> Reference </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#template-security-jinja2-sandboxing class=md-nav__link> <span class=md-ellipsis> Template Security (Jinja2 Sandboxing) </span> </a> <nav class=md-nav aria-label="Template Security (Jinja2 Sandboxing)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#risk-remote-code-execution-via-template-injection class=md-nav__link> <span class=md-ellipsis> Risk: Remote Code Execution via Template Injection </span> </a> </li> <li class=md-nav__item> <a href=#mitigation-sandboxed-environment class=md-nav__link> <span class=md-ellipsis> Mitigation: Sandboxed Environment </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#http-executor-security-ssrf-prevention class=md-nav__link> <span class=md-ellipsis> HTTP Executor Security (SSRF Prevention) </span> </a> <nav class=md-nav aria-label="HTTP Executor Security (SSRF Prevention)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#risk-server-side-request-forgery-ssrf class=md-nav__link> <span class=md-ellipsis> Risk: Server-Side Request Forgery (SSRF) </span> </a> </li> <li class=md-nav__item> <a href=#mitigation-url-validation-with-blocklistallowlist class=md-nav__link> <span class=md-ellipsis> Mitigation: URL Validation with Blocklist/Allowlist </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#artifact-path-security-path-traversal-prevention class=md-nav__link> <span class=md-ellipsis> Artifact Path Security (Path Traversal Prevention) </span> </a> <nav class=md-nav aria-label="Artifact Path Security (Path Traversal Prevention)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#risk-path-traversal-and-file-overwrite class=md-nav__link> <span class=md-ellipsis> Risk: Path Traversal and File Overwrite </span> </a> </li> <li class=md-nav__item> <a href=#mitigation-multi-layer-path-validation class=md-nav__link> <span class=md-ellipsis> Mitigation: Multi-Layer Path Validation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#python-tool-security class=md-nav__link> <span class=md-ellipsis> Python Tool Security </span> </a> <nav class=md-nav aria-label="Python Tool Security"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#risk-dangerous-file-operations-and-code-execution class=md-nav__link> <span class=md-ellipsis> Risk: Dangerous File Operations and Code Execution </span> </a> </li> <li class=md-nav__item> <a href=#mitigation-allowlist-user-consent class=md-nav__link> <span class=md-ellipsis> Mitigation: Allowlist + User Consent </span> </a> </li> <li class=md-nav__item> <a href=#best-practices class=md-nav__link> <span class=md-ellipsis> Best Practices </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#audit-logging class=md-nav__link> <span class=md-ellipsis> Audit Logging </span> </a> <nav class=md-nav aria-label="Audit Logging"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#log-format class=md-nav__link> <span class=md-ellipsis> Log Format </span> </a> </li> <li class=md-nav__item> <a href=#violation-types class=md-nav__link> <span class=md-ellipsis> Violation Types </span> </a> </li> <li class=md-nav__item> <a href=#log-levels class=md-nav__link> <span class=md-ellipsis> Log Levels </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configuration-best-practices class=md-nav__link> <span class=md-ellipsis> Configuration Best Practices </span> </a> <nav class=md-nav aria-label="Configuration Best Practices"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#developmenttesting class=md-nav__link> <span class=md-ellipsis> Development/Testing </span> </a> </li> <li class=md-nav__item> <a href=#production class=md-nav__link> <span class=md-ellipsis> Production </span> </a> </li> <li class=md-nav__item> <a href=#cicd class=md-nav__link> <span class=md-ellipsis> CI/CD </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#threat-model class=md-nav__link> <span class=md-ellipsis> Threat Model </span> </a> <nav class=md-nav aria-label="Threat Model"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#in-scope class=md-nav__link> <span class=md-ellipsis> In Scope </span> </a> </li> <li class=md-nav__item> <a href=#out-of-scope-future-work class=md-nav__link> <span class=md-ellipsis> Out of Scope (Future Work) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-updates class=md-nav__link> <span class=md-ellipsis> Security Updates </span> </a> <nav class=md-nav aria-label="Security Updates"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#reporting-vulnerabilities class=md-nav__link> <span class=md-ellipsis> Reporting Vulnerabilities </span> </a> </li> <li class=md-nav__item> <a href=#version-history class=md-nav__link> <span class=md-ellipsis> Version History </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#future-enhancements class=md-nav__link> <span class=md-ellipsis> Future Enhancements </span> </a> </li> <li class=md-nav__item> <a href=#testing class=md-nav__link> <span class=md-ellipsis> Testing </span> </a> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=security-considerations>Security Considerations<a class=headerlink href=#security-considerations title="Permanent link">&para;</a></h1> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>Strands CLI executes user-defined workflow specifications that may include templates, HTTP executors, and file operations. This document describes the security measures implemented to protect against common attack vectors when processing potentially untrusted workflow specs.</p> <p><strong>Security Principle</strong>: Defense-in-depth for user-editable specifications. All user-controlled inputs (YAML specs, templates, variables) are treated as potentially malicious and validated at multiple layers.</p> <hr> <h2 id=template-security-jinja2-sandboxing>Template Security (Jinja2 Sandboxing)<a class=headerlink href=#template-security-jinja2-sandboxing title="Permanent link">&para;</a></h2> <h3 id=risk-remote-code-execution-via-template-injection>Risk: Remote Code Execution via Template Injection<a class=headerlink href=#risk-remote-code-execution-via-template-injection title="Permanent link">&para;</a></h3> <p>Workflow specs use Jinja2 templates for dynamic content rendering in prompts, inputs, and artifact paths. Without proper sandboxing, attackers can exploit template introspection to execute arbitrary Python code.</p> <p><strong>Attack Example</strong>: <div class="language-yaml highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nt>outputs</span><span class=p>:</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;output.txt&quot;</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>      </span><span class=nt>from</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>&#39;&#39;.__class__.__mro__[1].__subclasses__()[104].__init__.__globals__[&#39;os&#39;].system(&#39;malicious_command&#39;)</span><span class=nv> </span><span class=s>}}&quot;</span>
</span></code></pre></div></p> <h3 id=mitigation-sandboxed-environment>Mitigation: Sandboxed Environment<a class=headerlink href=#mitigation-sandboxed-environment title="Permanent link">&para;</a></h3> <p><strong>Implementation</strong> (<code>src/strands_cli/loader/template.py</code>): - Uses <code>jinja2.sandbox.SandboxedEnvironment</code> instead of standard <code>Environment</code> - Explicitly whitelists only safe filters: <code>truncate</code>, <code>tojson</code> - Clears all globals to prevent access to Python builtins - Blocks attribute access to <code>__class__</code>, <code>__mro__</code>, <code>__subclasses__</code>, <code>__globals__</code>, etc.</p> <p><strong>Detection &amp; Logging</strong>: <div class="language-python highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># Security violations logged at WARNING level</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>    <span class=s2>&quot;template_security_violation&quot;</span><span class=p>,</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>    <span class=n>violation_type</span><span class=o>=</span><span class=s2>&quot;unsafe_operation&quot;</span><span class=p>,</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>    <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>    <span class=n>template_preview</span><span class=o>=</span><span class=n>template_str</span><span class=p>[:</span><span class=mi>100</span><span class=p>],</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=p>)</span>
</span></code></pre></div></p> <p><strong>What's Allowed</strong>: - Variable expansion: <code>{{ variable }}</code> - Whitelisted filters: <code>{{ text | truncate(100) }}</code>, <code>{{ data | tojson }}</code> - Safe attribute access: <code>{{ inputs.topic }}</code> - Whitelisted filters: <code>{{ text | truncate(100) }}</code>, <code>{{ data | tojson }}</code>, <code>{{ topic | title }}</code></p> <p><strong>What's Blocked</strong>: - Python introspection: <code>{{ ''.__class__ }}</code> - Builtin functions: <code>{{ eval(...) }}</code>, <code>{{ __import__(...) }}</code> - Non-whitelisted filters: <code>{{ text | upper }}</code> (only <code>truncate</code>, <code>tojson</code>, and <code>title</code> are allowed)</p> <hr> <h2 id=http-executor-security-ssrf-prevention>HTTP Executor Security (SSRF Prevention)<a class=headerlink href=#http-executor-security-ssrf-prevention title="Permanent link">&para;</a></h2> <h3 id=risk-server-side-request-forgery-ssrf>Risk: Server-Side Request Forgery (SSRF)<a class=headerlink href=#risk-server-side-request-forgery-ssrf title="Permanent link">&para;</a></h3> <p>HTTP executors allow specs to define arbitrary <code>base_url</code> values. Without validation, attackers can target internal services, cloud metadata endpoints, or local files.</p> <p><strong>Attack Example</strong>: <div class="language-yaml highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=nt>tools</span><span class=p>:</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=w>  </span><span class=nt>http_executors</span><span class=p>:</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=s>&quot;metadata-attack&quot;</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=w>      </span><span class=nt>base_url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;http://169.254.169.254/latest/meta-data/&quot;</span><span class=w>  </span><span class=c1># AWS metadata</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
</span></code></pre></div></p> <h3 id=mitigation-url-validation-with-blocklistallowlist>Mitigation: URL Validation with Blocklist/Allowlist<a class=headerlink href=#mitigation-url-validation-with-blocklistallowlist title="Permanent link">&para;</a></h3> <p><strong>Implementation</strong> (<code>src/strands_cli/types.py</code>, <code>src/strands_cli/config.py</code>):</p> <h4 id=default-blocked-patterns>Default Blocked Patterns<a class=headerlink href=#default-blocked-patterns title="Permanent link">&para;</a></h4> <p>Enforced for all HTTP executors: - Localhost: <code>127.0.0.1</code>, <code>localhost</code>, <code>[::1]</code> - AWS/Azure metadata: <code>169.254.169.254</code> - Private networks (RFC1918): <code>10.0.0.0/8</code>, <code>172.16.0.0/12</code>, <code>192.168.0.0/16</code> - Non-HTTP protocols: <code>file://</code>, <code>ftp://</code>, <code>gopher://</code></p> <h4 id=environment-variable-configuration>Environment Variable Configuration<a class=headerlink href=#environment-variable-configuration title="Permanent link">&para;</a></h4> <p><strong>Add custom blocked patterns</strong>: <div class="language-bash highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nb>export</span><span class=w> </span><span class=nv>STRANDS_HTTP_BLOCKED_PATTERNS</span><span class=o>=</span><span class=s1>&#39;[&quot;^https://internal-api\\.company\\.com&quot;]&#39;</span>
</span></code></pre></div></p> <p><strong>Enforce allowlist</strong> (blocks all URLs except those matching patterns): <div class="language-bash highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=nb>export</span><span class=w> </span><span class=nv>STRANDS_HTTP_ALLOWED_DOMAINS</span><span class=o>=</span><span class=s1>&#39;[&quot;^https://api\\.openai\\.com&quot;, &quot;^https://.*\\.trusted\\.com&quot;]&#39;</span>
</span></code></pre></div></p> <p><strong>Detection &amp; Logging</strong>: <div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1># SSRF attempts logged at WARNING level</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>    <span class=s2>&quot;http_url_blocked&quot;</span><span class=p>,</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>    <span class=n>violation_type</span><span class=o>=</span><span class=s2>&quot;ssrf_attempt&quot;</span><span class=p>,</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>    <span class=n>blocked_url</span><span class=o>=</span><span class=n>base_url</span><span class=p>,</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>    <span class=n>matched_pattern</span><span class=o>=</span><span class=n>pattern</span><span class=p>,</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=p>)</span>
</span></code></pre></div></p> <p><strong>What's Allowed by Default</strong>: - Public HTTPS URLs: <code>https://api.openai.com</code>, <code>https://api.example.com</code> - Public HTTP URLs: <code>http://api.example.com</code> (blocklist-based, not allowlist)</p> <p><strong>What's Blocked</strong>: - Localhost/loopback addresses - Private IP ranges - Cloud metadata endpoints - File/FTP/Gopher protocols - Any URL matching <code>STRANDS_HTTP_BLOCKED_PATTERNS</code> - If <code>STRANDS_HTTP_ALLOWED_DOMAINS</code> set: URLs not matching allowlist</p> <hr> <h2 id=artifact-path-security-path-traversal-prevention>Artifact Path Security (Path Traversal Prevention)<a class=headerlink href=#artifact-path-security-path-traversal-prevention title="Permanent link">&para;</a></h2> <h3 id=risk-path-traversal-and-file-overwrite>Risk: Path Traversal and File Overwrite<a class=headerlink href=#risk-path-traversal-and-file-overwrite title="Permanent link">&para;</a></h3> <p>Artifact paths can include templates that render user variables. Without validation, attackers can escape the output directory, overwrite system files, or follow symlinks outside the project.</p> <p><strong>Attack Examples</strong>: <div class="language-yaml highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=nt>outputs</span><span class=p>:</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>malicious</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>      </span><span class=nt>from</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>last_response</span><span class=nv> </span><span class=s>}}&quot;</span>
</span></code></pre></div> <div class="language-bash highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>strands<span class=w> </span>run<span class=w> </span>workflow.yaml<span class=w> </span>--var<span class=w> </span><span class=nv>malicious</span><span class=o>=</span><span class=s2>&quot;../../etc/passwd&quot;</span>
</span></code></pre></div></p> <h3 id=mitigation-multi-layer-path-validation>Mitigation: Multi-Layer Path Validation<a class=headerlink href=#mitigation-multi-layer-path-validation title="Permanent link">&para;</a></h3> <p><strong>Implementation</strong> (<code>src/strands_cli/artifacts/io.py</code>):</p> <h4 id=1-reject-absolute-paths>1. Reject Absolute Paths<a class=headerlink href=#1-reject-absolute-paths title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=k>if</span> <span class=n>path_obj</span><span class=o>.</span><span class=n>is_absolute</span><span class=p>():</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>    <span class=k>raise</span> <span class=n>ArtifactError</span><span class=p>(</span><span class=s2>&quot;Absolute paths not allowed in artifacts&quot;</span><span class=p>)</span>
</span></code></pre></div> <h4 id=2-block-path-traversal-components>2. Block Path Traversal (<code>..</code> components)<a class=headerlink href=#2-block-path-traversal-components title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=k>if</span> <span class=s2>&quot;..&quot;</span> <span class=ow>in</span> <span class=n>path_obj</span><span class=o>.</span><span class=n>parts</span><span class=p>:</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>    <span class=k>raise</span> <span class=n>ArtifactError</span><span class=p>(</span><span class=s2>&quot;Path traversal not allowed&quot;</span><span class=p>)</span>
</span></code></pre></div> <h4 id=3-sanitize-path-components>3. Sanitize Path Components<a class=headerlink href=#3-sanitize-path-components title="Permanent link">&para;</a></h4> <p>Each component sanitized with <code>sanitize_filename()</code>: - Removes path separators (<code>/</code>, <code>\</code>) - Replaces special characters with <code>_</code> - Strips leading/trailing dots and underscores</p> <h4 id=4-validate-resolved-path>4. Validate Resolved Path<a class=headerlink href=#4-validate-resolved-path title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=n>artifact_path</span><span class=o>.</span><span class=n>relative_to</span><span class=p>(</span><span class=n>output_dir</span><span class=o>.</span><span class=n>resolve</span><span class=p>())</span>  <span class=c1># Raises ValueError if escaped</span>
</span></code></pre></div> <h4 id=5-block-symlinks-mvp>5. Block Symlinks (MVP)<a class=headerlink href=#5-block-symlinks-mvp title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=k>if</span> <span class=n>artifact_path</span><span class=o>.</span><span class=n>is_symlink</span><span class=p>():</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>    <span class=k>raise</span> <span class=n>ArtifactError</span><span class=p>(</span><span class=s2>&quot;Symlinks are not allowed for security reasons&quot;</span><span class=p>)</span>
</span></code></pre></div> <p><strong>Detection &amp; Logging</strong>: <div class="language-python highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1># Path traversal attempts logged at WARNING level</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>    <span class=s2>&quot;artifact_path_blocked&quot;</span><span class=p>,</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>    <span class=n>violation_type</span><span class=o>=</span><span class=s2>&quot;path_traversal_attempt&quot;</span><span class=p>,</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>    <span class=n>attempted_path</span><span class=o>=</span><span class=n>rendered_path</span><span class=p>,</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>    <span class=n>artifact_template</span><span class=o>=</span><span class=n>artifact</span><span class=o>.</span><span class=n>path</span><span class=p>,</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=p>)</span>
</span></code></pre></div></p> <p><strong>What's Allowed</strong>: - Relative paths: <code>output.txt</code>, <code>reports/summary.md</code> - Nested directories: <code>analysis/data/results.json</code> - Template variables: <code>{{ spec.name }}-report.txt</code></p> <p><strong>What's Blocked</strong>: - Absolute paths: <code>/etc/passwd</code>, <code>C:\Windows\System32\config</code> - Path traversal: <code>../../etc/passwd</code>, <code>..\..\..\windows\hosts</code> - Symlinks (for MVP; may be reconsidered in future releases)</p> <hr> <h2 id=python-tool-security>Python Tool Security<a class=headerlink href=#python-tool-security title="Permanent link">&para;</a></h2> <h3 id=risk-dangerous-file-operations-and-code-execution>Risk: Dangerous File Operations and Code Execution<a class=headerlink href=#risk-dangerous-file-operations-and-code-execution title="Permanent link">&para;</a></h3> <p>Python tools can perform file operations and execute code within the workflow environment. The <code>file_write</code> tool, in particular, can modify the filesystem and requires careful usage.</p> <p><strong>Attack Example</strong>: <div class="language-yaml highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=nt>tools</span><span class=p>:</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=w>  </span><span class=nt>python</span><span class=p>:</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>callable</span><span class=p>:</span><span class=w> </span><span class=s>&quot;strands_tools.file_write.file_write&quot;</span>
</span></code></pre></div> <div class="language-bash highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1># Malicious prompt could attempt to overwrite system files</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>strands<span class=w> </span>run<span class=w> </span>workflow.yaml<span class=w> </span>--var<span class=w> </span><span class=nv>path</span><span class=o>=</span><span class=s2>&quot;/etc/passwd&quot;</span><span class=w> </span>--var<span class=w> </span><span class=nv>content</span><span class=o>=</span><span class=s2>&quot;malicious&quot;</span>
</span></code></pre></div></p> <h3 id=mitigation-allowlist-user-consent>Mitigation: Allowlist + User Consent<a class=headerlink href=#mitigation-allowlist-user-consent title="Permanent link">&para;</a></h3> <p><strong>Implementation</strong> (<code>src/strands_cli/capability/checker.py</code>, <code>src/strands_cli/runtime/tools.py</code>):</p> <h4 id=allowlisted-python-tools>Allowlisted Python Tools<a class=headerlink href=#allowlisted-python-tools title="Permanent link">&para;</a></h4> <p>Only the following Python callables are permitted: - <code>strands_tools.http_request.http_request</code> - Make HTTP requests (subject to SSRF protection) - <code>strands_tools.file_read.file_read</code> - Read files (read-only access) - <code>strands_tools.file_write.file_write</code> - Write files (requires consent) - <code>strands_tools.calculator.calculator</code> - Mathematical calculations (SymPy-based) - <code>strands_tools.current_time.current_time</code> - Get current date/time (read-only)</p> <p>Any tool not in this allowlist will trigger exit code 18 with remediation report.</p> <h4 id=user-consent-for-file_write>User Consent for file_write<a class=headerlink href=#user-consent-for-file_write title="Permanent link">&para;</a></h4> <p>The <code>file_write</code> tool includes <strong>interactive consent prompts</strong> to prevent unintended file modifications. The tool will: 1. Display the target file path and content preview 2. Prompt user to confirm the write operation 3. Allow user to deny (skip) or approve each write</p> <p><strong>Bypassing Consent (Automation Mode)</strong>:</p> <p>For CI/CD pipelines and automation scenarios, use the <code>--bypass-tool-consent</code> flag:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>strands<span class=w> </span>run<span class=w> </span>workflow.yaml<span class=w> </span>--bypass-tool-consent
</span></code></pre></div> <p>This sets the <code>BYPASS_TOOL_CONSENT=true</code> environment variable, which the Strands SDK's <code>file_write</code> tool respects.</p> <p><strong>⚠️ Security Warning</strong>: Only use <code>--bypass-tool-consent</code> in trusted, controlled environments: - ✅ CI/CD pipelines with reviewed workflow specs - ✅ Automated testing with known, safe inputs - ❌ Production workflows processing untrusted user inputs - ❌ Workflows from external/untrusted sources</p> <h4 id=tool-loading-architecture>Tool Loading Architecture<a class=headerlink href=#tool-loading-architecture title="Permanent link">&para;</a></h4> <p><strong>Two Tool Types</strong> (<code>src/strands_cli/runtime/tools.py</code>): 1. <strong>@tool decorated functions</strong>: Returns function object directly 2. <strong>Module-based tools</strong>: Returns module with <code>TOOL_SPEC</code> attribute</p> <p>The CLI automatically detects which type and loads appropriately: <div class="language-python highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>module</span><span class=p>,</span> <span class=s2>&quot;TOOL_SPEC&quot;</span><span class=p>):</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>    <span class=k>return</span> <span class=n>module</span>  <span class=c1># Module-based tool (e.g., file_write)</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=k>else</span><span class=p>:</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>    <span class=k>return</span> <span class=n>callable_obj</span>  <span class=c1># @tool decorated function</span>
</span></code></pre></div></p> <p><strong>Detection &amp; Logging</strong>: <div class="language-python highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=c1># Disallowed tool attempts logged at WARNING level</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>    <span class=s2>&quot;tool_blocked&quot;</span><span class=p>,</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>    <span class=n>violation_type</span><span class=o>=</span><span class=s2>&quot;disallowed_python_callable&quot;</span><span class=p>,</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>    <span class=n>attempted_callable</span><span class=o>=</span><span class=n>callable_path</span><span class=p>,</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>    <span class=n>allowlist</span><span class=o>=</span><span class=n>ALLOWED_PYTHON_CALLABLES</span><span class=p>,</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=p>)</span>
</span></code></pre></div></p> <p><strong>What's Allowed</strong>: - Allowlisted tools only (see list above) - String format: <code>["strands_tools.calculator.calculator"]</code> - Dict format: <code>[{"callable": "strands_tools.calculator.calculator"}]</code></p> <p><strong>What's Blocked</strong>: - Any Python callable not in allowlist - Arbitrary imports like <code>os.system</code>, <code>subprocess.run</code> - Tools with old path format (migration required)</p> <h3 id=best-practices>Best Practices<a class=headerlink href=#best-practices title="Permanent link">&para;</a></h3> <p><strong>Development/Testing</strong>: <div class="language-bash highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1># Interactive mode (prompts for file_write consent)</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>strands<span class=w> </span>run<span class=w> </span>workflow.yaml
</span></code></pre></div></p> <p><strong>Production/CI</strong>: <div class="language-bash highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1># Review spec for file_write tool usage first</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>strands<span class=w> </span>validate<span class=w> </span>workflow.yaml
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=c1># Run with bypass only after review</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>strands<span class=w> </span>run<span class=w> </span>workflow.yaml<span class=w> </span>--bypass-tool-consent<span class=w> </span>--force
</span></code></pre></div></p> <p><strong>Audit file operations</strong>: <div class="language-bash highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1># Enable structured logging to track file_write operations</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=nb>export</span><span class=w> </span><span class=nv>STRANDS_LOG_LEVEL</span><span class=o>=</span>INFO
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=nb>export</span><span class=w> </span><span class=nv>STRANDS_LOG_FORMAT</span><span class=o>=</span>json
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a>strands<span class=w> </span>run<span class=w> </span>workflow.yaml<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>file_write
</span></code></pre></div></p> <hr> <h2 id=audit-logging>Audit Logging<a class=headerlink href=#audit-logging title="Permanent link">&para;</a></h2> <p>All security violations are logged using <code>structlog</code> with structured fields for analysis:</p> <h3 id=log-format>Log Format<a class=headerlink href=#log-format title="Permanent link">&para;</a></h3> <div class="language-json highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=p>{</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=w>  </span><span class=nt>&quot;event&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;template_security_violation&quot;</span><span class=p>,</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=w>  </span><span class=nt>&quot;violation_type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;unsafe_operation&quot;</span><span class=p>,</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=w>  </span><span class=nt>&quot;error&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;SecurityError: access to attribute &#39;__class__&#39; of &#39;str&#39; object is unsafe&quot;</span><span class=p>,</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=w>  </span><span class=nt>&quot;template_preview&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;{{ &#39;&#39;.__class__ }}&quot;</span><span class=p>,</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=w>  </span><span class=nt>&quot;timestamp&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2025-11-06T05:03:46Z&quot;</span><span class=p>,</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=w>  </span><span class=nt>&quot;level&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;warning&quot;</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=p>}</span>
</span></code></pre></div> <h3 id=violation-types>Violation Types<a class=headerlink href=#violation-types title="Permanent link">&para;</a></h3> <ul> <li><code>template_security_violation</code>: Template sandbox escape attempt</li> <li><code>http_url_blocked</code>: SSRF attempt (localhost, metadata endpoint, etc.)</li> <li><code>artifact_path_blocked</code>: Path traversal or absolute path attempt</li> <li><code>tool_blocked</code>: Disallowed Python callable attempt</li> </ul> <h3 id=log-levels>Log Levels<a class=headerlink href=#log-levels title="Permanent link">&para;</a></h3> <ul> <li><strong>WARNING</strong>: Security policy violation (blocked before execution)</li> <li><strong>ERROR</strong>: Unexpected security failure</li> <li><strong>INFO</strong>: Normal operations (not security-related)</li> </ul> <hr> <h2 id=configuration-best-practices>Configuration Best Practices<a class=headerlink href=#configuration-best-practices title="Permanent link">&para;</a></h2> <h3 id=developmenttesting>Development/Testing<a class=headerlink href=#developmenttesting title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1># Allow localhost for local testing</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=nb>export</span><span class=w> </span><span class=nv>STRANDS_HTTP_ALLOWED_DOMAINS</span><span class=o>=</span><span class=s1>&#39;[&quot;^http://localhost&quot;]&#39;</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=c1># Run with interactive file_write consent</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>strands<span class=w> </span>run<span class=w> </span>workflow.yaml
</span></code></pre></div> <h3 id=production>Production<a class=headerlink href=#production title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1># Enforce strict allowlist</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=nb>export</span><span class=w> </span><span class=nv>STRANDS_HTTP_ALLOWED_DOMAINS</span><span class=o>=</span><span class=s1>&#39;[&quot;^https://api\\.openai\\.com&quot;, &quot;^https://api\\.anthropic\\.com&quot;]&#39;</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=c1># Block additional internal patterns</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=nb>export</span><span class=w> </span><span class=nv>STRANDS_HTTP_BLOCKED_PATTERNS</span><span class=o>=</span><span class=s1>&#39;[&quot;^https://.*\\.internal\\.company\\.com&quot;]&#39;</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=c1># Review workflow before bypassing tool consent</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a>strands<span class=w> </span>validate<span class=w> </span>workflow.yaml
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a>strands<span class=w> </span>run<span class=w> </span>workflow.yaml<span class=w> </span>--bypass-tool-consent<span class=w> </span>--force
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=c1># Review security logs</span>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=nb>export</span><span class=w> </span><span class=nv>STRANDS_LOG_LEVEL</span><span class=o>=</span>WARNING
</span><span id=__span-23-13><a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=nb>export</span><span class=w> </span><span class=nv>STRANDS_LOG_FORMAT</span><span class=o>=</span>json
</span></code></pre></div> <h3 id=cicd>CI/CD<a class=headerlink href=#cicd title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1># Run specs from untrusted sources with maximum restrictions</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=nb>export</span><span class=w> </span><span class=nv>STRANDS_HTTP_ALLOWED_DOMAINS</span><span class=o>=</span><span class=s1>&#39;[&quot;^https://api\\.trusted\\.com&quot;]&#39;</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=c1># Review for dangerous tools</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;file_write|http_request&quot;</span><span class=w> </span>workflow.yaml
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=c1># Never use --bypass-tool-consent for untrusted specs</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=c1># Never use --force flag (prevent artifact overwrites)</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a>strands<span class=w> </span>run<span class=w> </span>untrusted-spec.yaml
</span></code></pre></div> <hr> <h2 id=threat-model>Threat Model<a class=headerlink href=#threat-model title="Permanent link">&para;</a></h2> <h3 id=in-scope>In Scope<a class=headerlink href=#in-scope title="Permanent link">&para;</a></h3> <ul> <li><strong>User-editable workflow specs</strong>: Assumes specs may be malicious (YAML/JSON from untrusted sources)</li> <li><strong>Template injection</strong>: Prevents code execution via Jinja2 templates</li> <li><strong>SSRF attacks</strong>: Prevents internal network scanning and metadata access</li> <li><strong>Path traversal</strong>: Prevents file overwrite and directory escape</li> <li><strong>Data exfiltration</strong>: Limits HTTP executor targets via allowlist/blocklist</li> <li><strong>Dangerous tool usage</strong>: Allowlist restricts Python callables; file_write requires consent</li> </ul> <h3 id=out-of-scope-future-work>Out of Scope (Future Work)<a class=headerlink href=#out-of-scope-future-work title="Permanent link">&para;</a></h3> <ul> <li><strong>Dependency confusion</strong>: Python tool imports are allowlisted but not package-pinned</li> <li><strong>Resource exhaustion</strong>: No rate limiting on LLM calls (budgets logged only)</li> <li><strong>Secrets exposure</strong>: Env-only secrets assumed secure (Secrets Manager support planned)</li> <li><strong>Supply chain</strong>: MCP servers not validated (future hardening needed)</li> <li><strong>File operation sandboxing</strong>: file_write can write anywhere writable; no chroot/jail</li> </ul> <hr> <h2 id=security-updates>Security Updates<a class=headerlink href=#security-updates title="Permanent link">&para;</a></h2> <h3 id=reporting-vulnerabilities>Reporting Vulnerabilities<a class=headerlink href=#reporting-vulnerabilities title="Permanent link">&para;</a></h3> <p>Report security issues to: [maintainer contact - TBD]</p> <h3 id=version-history>Version History<a class=headerlink href=#version-history title="Permanent link">&para;</a></h3> <ul> <li><strong>v0.5.0</strong>: Expanded Python tool allowlist (added file_write, calculator, current_time); added --bypass-tool-consent flag; improved tool loading architecture</li> <li><strong>v0.4.0</strong>: Initial security hardening (Jinja2 sandbox, HTTP validation, path security)</li> <li><strong>v0.3.0</strong>: Multi-agent support (no security hardening)</li> <li><strong>v0.2.0</strong>: Single-agent MVP</li> </ul> <hr> <h2 id=future-enhancements>Future Enhancements<a class=headerlink href=#future-enhancements title="Permanent link">&para;</a></h2> <ol> <li><strong>Content Security Policy</strong> for HTTP responses (validate Content-Type, size limits)</li> <li><strong>MCP Server Sandboxing</strong> (isolate MCP processes, allowlist executables)</li> <li><strong>Rate Limiting</strong> (enforce budget limits, prevent runaway costs)</li> <li><strong>Secrets Manager Integration</strong> (replace env-only secrets with secure vaults)</li> <li><strong>Python Tool Sandboxing</strong> (chroot/jail for file operations, restrict network access)</li> <li><strong>Symlink Policy Refinement</strong> (allow symlinks within output_dir after validation)</li> <li><strong>Tool Package Pinning</strong> (pin versions of strands_tools dependencies)</li> </ol> <hr> <h2 id=testing>Testing<a class=headerlink href=#testing title="Permanent link">&para;</a></h2> <p>Security features are covered by comprehensive negative tests:</p> <ul> <li><strong>Template Security</strong>: 9 tests blocking introspection, eval, import</li> <li><strong>HTTP Security</strong>: 14 tests blocking SSRF vectors and validating env vars</li> <li><strong>Path Security</strong>: 7 tests blocking traversal, absolute paths, symlinks</li> <li><strong>Tool Security</strong>: 5 tests validating allowlist enforcement and tool loading</li> </ul> <p>Run security tests: <div class="language-bash highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>uv<span class=w> </span>run<span class=w> </span>pytest<span class=w> </span>tests/test_executor.py::TestTemplateSecurity<span class=w> </span>-v
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>uv<span class=w> </span>run<span class=w> </span>pytest<span class=w> </span>tests/test_runtime.py::TestHttpExecutorSecurity<span class=w> </span>-v
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>uv<span class=w> </span>run<span class=w> </span>pytest<span class=w> </span>tests/test_executor.py::TestArtifactPathSecurity<span class=w> </span>-v
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a>uv<span class=w> </span>run<span class=w> </span>pytest<span class=w> </span>tests/test_capability.py::TestCapabilityChecker::test_check_python_tools<span class=w> </span>-v
</span></code></pre></div></p> <hr> <h2 id=summary>Summary<a class=headerlink href=#summary title="Permanent link">&para;</a></h2> <p>Strands CLI implements defense-in-depth for user-editable workflow specs: 1. <strong>Templates</strong> → Sandboxed Jinja2 (no code execution) 2. <strong>HTTP Executors</strong> → URL validation (no SSRF) 3. <strong>Artifact Paths</strong> → Multi-layer checks (no path traversal) 4. <strong>Python Tools</strong> → Allowlist + user consent for dangerous operations 5. <strong>Audit Logging</strong> → Structured security events</p> <p>All violations logged at WARNING level with actionable context for operators.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/ThomasRohde/strands-cli target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.copy", "content.code.annotate", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "navigation.tracking", "toc.follow", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.f1b6f286.min.js></script> </body> </html>