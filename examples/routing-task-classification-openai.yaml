# Task Classification Routing Example with OpenAI Provider
#
# This example demonstrates intelligent task routing with specialized agents.
# A router agent classifies incoming tasks and routes them to coding, research,
# or writing specialists based on the task requirements.
#
# Prerequisites:
#   1. Set OPENAI_API_KEY environment variable:
#      - Linux/Mac: export OPENAI_API_KEY=your-api-key
#      - Windows: $env:OPENAI_API_KEY="your-api-key"
#   2. Install dependencies: uv sync
#
# Usage:
#   uv run strands run examples/routing-task-classification-openai.yaml --var task="Explain how binary search works"
#
# Features Demonstrated:
#   - OpenAI provider with low temperature for classification
#   - Routing pattern with intelligent task classification
#   - Multi-agent collaboration (4 specialized agents)
#   - Router decision exposed in template ({{ router.chosen_route }})
#   - Multi-step routes with cross-agent collaboration
#   - Configurable max_retries for router

version: 0
name: "task-classifier-openai"
description: "Classify tasks and route to specialized agents (coding, research, or writing)"

runtime:
  provider: openai
  model_id: gpt-4o-mini
  temperature: 0.2
  max_tokens: 4000

inputs:
  values:
    task: "Explain how binary search works"

agents:
  task_router:
    prompt: |
      You are an intelligent task classifier. Analyze the given task and determine which type of agent
      should handle it.
      
      Available routes:
      - coding: Programming tasks, code reviews, algorithm implementations, debugging
      - research: Information gathering, analysis, summaries, comparisons
      - writing: Content creation, documentation, creative writing, editing
      
      Respond with ONLY valid JSON:
      {"route": "<route_name>"}
      
      Base your decision on the primary nature of the task.

  coder:
    prompt: |
      You are an expert software engineer. Implement clean, well-documented code with examples
      and explanations. Focus on best practices and clarity.

  researcher:
    prompt: |
      You are a thorough researcher. Gather information systematically, analyze multiple perspectives,
      and provide well-sourced insights.

  writer:
    prompt: |
      You are a skilled technical writer. Create clear, engaging content that is well-structured
      and accessible to your target audience.

pattern:
  type: routing
  config:
    router:
      agent: task_router
      input: |
        Task: {{ task }}
        
        Classify this task as: coding, research, or writing
      max_retries: 3
    
    routes:
      coding:
        then:
          - agent: coder
            input: |
              Task: {{ task }}
              
              Provide a complete code implementation with explanations and examples.
              Selected route: {{ router.chosen_route }}
          - agent: writer
            input: |
              Take this code and create user-friendly documentation:
              
              {{ steps[0].response }}
      
      research:
        then:
          - agent: researcher
            input: |
              Research topic: {{ task }}
              
              Conduct thorough research and provide comprehensive findings.
              Selected route: {{ router.chosen_route }}
          - agent: writer
            input: |
              Transform these research findings into a well-organized article:
              
              {{ steps[0].response }}
      
      writing:
        then:
          - agent: writer
            input: |
              Writing task: {{ task }}
              
              Create high-quality content that addresses the task requirements.
              Selected route: {{ router.chosen_route }}

outputs:
  artifacts:
    - path: "./artifacts/task-{{ chosen_route }}-output.md"
      from: "{{ last_response }}"
