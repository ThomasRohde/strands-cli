version: 0
name: "evaluator-optimizer-writing-ollama"
description: "Iterative content refinement with evaluator feedback using Ollama"
tags: ["evaluator-optimizer", "content", "ollama"]

runtime:
  provider: ollama
  host: "http://localhost:11434"
  model_id: "qwen2.5:32b"
  budgets:
    max_tokens: 50000

agents:
  writer:
    prompt: |
      You are an expert content writer. Create well-structured, engaging content.
      
      Write a professional blog post about artificial intelligence for technical professionals.
      
      Focus on:
      - Clear, concise writing
      - Logical flow and structure
      - Accurate information
      - Engaging introduction and conclusion
  
  critic:
    prompt: |
      You are a critical editor who evaluates content quality.
      
      Evaluate the following draft and return your assessment as JSON.
      
      Required JSON format:
      {
        "score": <0-100>,
        "issues": ["issue1", "issue2", ...],
        "fixes": ["fix1", "fix2", ...]
      }
      
      Scoring criteria:
      - 90-100: Excellent - publication ready
      - 80-89: Good - minor improvements needed
      - 70-79: Fair - moderate improvements needed  
      - 60-69: Poor - significant improvements needed
      - <60: Needs major revision
      
      Evaluate for:
      - Clarity and readability
      - Logical structure
      - Accuracy and depth
      - Grammar and style
      - Engagement factor

pattern:
  type: evaluator_optimizer
  config:
    producer: writer
    
    evaluator:
      agent: critic
      input: |
        Evaluate this draft about artificial intelligence:
        
        === DRAFT ===
        {{ draft }}
        === END DRAFT ===
        
        Return your evaluation as JSON with score, issues, and fixes.
    
    accept:
      min_score: 85
      max_iters: 3
    
    # Optional: Custom revision prompt (if omitted, uses generic default template)
    # Default template includes: {{ draft }}, {{ evaluation.score }}, {{ evaluation.issues }}, {{ evaluation.fixes }}
    # Custom prompts enable domain-specific guidance and formatting
    revise_prompt: |
      Your previous draft scored {{ evaluation.score }}/100.
      
      Issues identified:
      {% for issue in evaluation.issues %}
      - {{ issue }}
      {% endfor %}
      
      Suggested fixes:
      {% for fix in evaluation.fixes %}
      - {{ fix %}
      {% endfor %}
      
      Please revise the draft to address these issues. Maintain the topic (artificial intelligence) and professional blog post style.
      Focus on improving the areas mentioned in the feedback.

outputs:
  artifacts:
    - path: "./refined-content.md"
      from: "{{ last_response }}"
